import{a as U,b as G}from"./chunk-PFHXWNFC.js";function Ou(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach(function(t){Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==null&&(typeof e[t]=="object"||typeof e[t]=="function")&&!Object.isFrozen(e[t])&&Ou(e[t])}),e}function fi(e){var t=e.split("."),r=t.length;return r===1?o=>o[e]:o=>{for(var n=o,i=0;i<r;++i){var s=t[i];if(n=n[s],typeof n>"u")return n}return n}}function Eu(e){var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))if(typeof e[r]=="object"){var o=Eu(e[r]);for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[r+"."+n]=o[n])}else t[r]=e[r];return t}function q(e){return Object.assign({},e)}function mi(e){return Object.keys(e)[0]}function ht(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((o,n)=>typeof o=="string"&&typeof n=="string"?o.localeCompare(n):typeof o=="object"?1:-1).map(o=>ht(o,t));if(typeof e=="object"&&!Array.isArray(e)){var r={};return Object.keys(e).sort((o,n)=>o.localeCompare(n)).forEach(o=>{r[o]=ht(e[o],t)}),r}return e}function Uo(e){if(!e||e===null||typeof e!="object")return e;if(Array.isArray(e)){for(var t=new Array(e.length),r=t.length;r--;)t[r]=Uo(e[r]);return t}var o={};for(var n in e)o[n]=Uo(e[n]);return o}var $e=Uo;function le(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}function Ye(e){"@babel/helpers - typeof";return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ye(e)}function pi(e,t){if(Ye(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t||"default");if(Ye(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hi(e){var t=pi(e,"string");return Ye(t)=="symbol"?t:t+""}function di(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,hi(o.key),o)}}function ee(e,t,r){return t&&di(e.prototype,t),r&&di(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Le(e,t){return Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},Le(e,t)}function jo(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Le(e,t)}function mr(e){return mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mr(e)}function yi(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Vo(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Vo=function(){return!!e})()}function gi(e,t,r){if(Vo())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var n=new(e.bind.apply(e,o));return r&&Le(n,r.prototype),n}function Vt(e){var t=typeof Map=="function"?new Map:void 0;return Vt=function(o){if(o===null||!yi(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(o))return t.get(o);t.set(o,n)}function n(){return gi(o,arguments,mr(this).constructor)}return n.prototype=Object.create(o.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Le(n,o)},Vt(e)}var F={isDevMode(){return!1},deepFreezeWhenDevMode(e){return e},tunnelErrorMessage(e){return"RxDB Error-Code "+e+`.
        Error messages are not included in RxDB core to reduce build size.
        `}};function Su(e){var t="";return Object.keys(e).length===0||(t+=`Given parameters: {
`,t+=Object.keys(e).map(r=>{var o="[object Object]";try{r==="errors"?o=e[r].map(n=>JSON.stringify(n,Object.getOwnPropertyNames(n))):o=JSON.stringify(e[r],function(n,i){return i===void 0?null:i},2)}catch{}return r+":"+o}).join(`
`),t+="}"),t}function vi(e,t,r){return"RxError ("+t+`):
`+e+`
`+Su(r)}var $u=function(e){function t(o,n,i={}){var s,a=vi(n,o,i);return s=e.call(this,a)||this,s.code=o,s.message=a,s.url=Wo(o),s.parameters=i,s.rxdb=!0,s}jo(t,e);var r=t.prototype;return r.toString=function(){return this.message},ee(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(Vt(Error)),Au=function(e){function t(o,n,i={}){var s,a=vi(n,o,i);return s=e.call(this,a)||this,s.code=o,s.message=a,s.url=Wo(o),s.parameters=i,s.rxdb=!0,s}jo(t,e);var r=t.prototype;return r.toString=function(){return this.message},ee(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])}(Vt(TypeError));function Wo(e){return"https://rxdb.info/errors.html?console=errors#"+e}function xi(e){return`
 You can find out more about this error here: `+Wo(e)+" "}function _(e,t){return new $u(e,F.tunnelErrorMessage(e)+xi(e),t)}function pr(e,t){return new Au(e,F.tunnelErrorMessage(e)+xi(e),t)}function hr(e){return e&&e.status===409?e:!1}var Iu={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function bi(e){return _("COL20",{name:Iu[e.status],document:e.documentId,writeError:e})}function E(e){return typeof e=="function"}function dt(e){let r=e(o=>{Error.call(o),o.stack=new Error().stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var dr=dt(e=>function(r){e(this),this.message=r?`${r.length} errors occurred during unsubscription:
${r.map((o,n)=>`${n+1}) ${o.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=r});function Ge(e,t){if(e){let r=e.indexOf(t);0<=r&&e.splice(r,1)}}var K=class e{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(let i of r)i.remove(this);else r.remove(this);let{initialTeardown:o}=this;if(E(o))try{o()}catch(i){t=i instanceof dr?i.errors:[i]}let{_finalizers:n}=this;if(n){this._finalizers=null;for(let i of n)try{_i(i)}catch(s){t=t??[],s instanceof dr?t=[...t,...s.errors]:t.push(s)}}if(t)throw new dr(t)}}add(t){var r;if(t&&t!==this)if(this.closed)_i(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}}_hasParent(t){let{_parentage:r}=this;return r===t||Array.isArray(r)&&r.includes(t)}_addParent(t){let{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t}_removeParent(t){let{_parentage:r}=this;r===t?this._parentage=null:Array.isArray(r)&&Ge(r,t)}remove(t){let{_finalizers:r}=this;r&&Ge(r,t),t instanceof e&&t._removeParent(this)}};K.EMPTY=(()=>{let e=new K;return e.closed=!0,e})();var qo=K.EMPTY;function yr(e){return e instanceof K||e&&"closed"in e&&E(e.remove)&&E(e.add)&&E(e.unsubscribe)}function _i(e){E(e)?e():e.unsubscribe()}var _e={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var yt={setTimeout(e,t,...r){let{delegate:o}=yt;return o?.setTimeout?o.setTimeout(e,t,...r):setTimeout(e,t,...r)},clearTimeout(e){let{delegate:t}=yt;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function gr(e){yt.setTimeout(()=>{let{onUnhandledError:t}=_e;if(t)t(e);else throw e})}function Je(){}var wi=zo("C",void 0,void 0);function Oi(e){return zo("E",void 0,e)}function Ei(e){return zo("N",e,void 0)}function zo(e,t,r){return{kind:e,value:t,error:r}}var Xe=null;function gt(e){if(_e.useDeprecatedSynchronousErrorHandling){let t=!Xe;if(t&&(Xe={errorThrown:!1,error:null}),e(),t){let{errorThrown:r,error:o}=Xe;if(Xe=null,r)throw o}}else e()}function Si(e){_e.useDeprecatedSynchronousErrorHandling&&Xe&&(Xe.errorThrown=!0,Xe.error=e)}var Ze=class extends K{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,yr(t)&&t.add(this)):this.destination=Tu}static create(t,r,o){return new Me(t,r,o)}next(t){this.isStopped?Ko(Ei(t),this):this._next(t)}error(t){this.isStopped?Ko(Oi(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Ko(wi,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Ru=Function.prototype.bind;function Ho(e,t){return Ru.call(e,t)}var Qo=class{constructor(t){this.partialObserver=t}next(t){let{partialObserver:r}=this;if(r.next)try{r.next(t)}catch(o){vr(o)}}error(t){let{partialObserver:r}=this;if(r.error)try{r.error(t)}catch(o){vr(o)}else vr(t)}complete(){let{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(r){vr(r)}}},Me=class extends Ze{constructor(t,r,o){super();let n;if(E(t)||!t)n={next:t??void 0,error:r??void 0,complete:o??void 0};else{let i;this&&_e.useDeprecatedNextContext?(i=Object.create(t),i.unsubscribe=()=>this.unsubscribe(),n={next:t.next&&Ho(t.next,i),error:t.error&&Ho(t.error,i),complete:t.complete&&Ho(t.complete,i)}):n=t}this.destination=new Qo(n)}};function vr(e){_e.useDeprecatedSynchronousErrorHandling?Si(e):gr(e)}function Cu(e){throw e}function Ko(e,t){let{onStoppedNotification:r}=_e;r&&yt.setTimeout(()=>r(e,t))}var Tu={closed:!0,next:Je,error:Cu,complete:Je};var vt=typeof Symbol=="function"&&Symbol.observable||"@@observable";function te(e){return e}function Du(...e){return Yo(e)}function Yo(e){return e.length===0?te:e.length===1?e[0]:function(r){return e.reduce((o,n)=>n(o),r)}}var R=(()=>{class e{constructor(r){r&&(this._subscribe=r)}lift(r){let o=new e;return o.source=this,o.operator=r,o}subscribe(r,o,n){let i=Nu(r)?r:new Me(r,o,n);return gt(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(r){try{return this._subscribe(r)}catch(o){r.error(o)}}forEach(r,o){return o=$i(o),new o((n,i)=>{let s=new Me({next:a=>{try{r(a)}catch(u){i(u),s.unsubscribe()}},error:i,complete:n});this.subscribe(s)})}_subscribe(r){var o;return(o=this.source)===null||o===void 0?void 0:o.subscribe(r)}[vt](){return this}pipe(...r){return Yo(r)(this)}toPromise(r){return r=$i(r),new r((o,n)=>{let i;this.subscribe(s=>i=s,s=>n(s),()=>o(i))})}}return e.create=t=>new e(t),e})();function $i(e){var t;return(t=e??_e.Promise)!==null&&t!==void 0?t:Promise}function Mu(e){return e&&E(e.next)&&E(e.error)&&E(e.complete)}function Nu(e){return e&&e instanceof Ze||Mu(e)&&yr(e)}var Ai=dt(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ae=(()=>{class e extends R{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){let o=new xr(this,this);return o.operator=r,o}_throwIfClosed(){if(this.closed)throw new Ai}next(r){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let o of this.currentObservers)o.next(r)}})}error(r){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;let{observers:o}=this;for(;o.length;)o.shift().error(r)}})}complete(){gt(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){let{hasError:o,isStopped:n,observers:i}=this;return o||n?qo:(this.currentObservers=null,i.push(r),new K(()=>{this.currentObservers=null,Ge(i,r)}))}_checkFinalizedStatuses(r){let{hasError:o,thrownError:n,isStopped:i}=this;o?r.error(n):i&&r.complete()}asObservable(){let r=new R;return r.source=this,r}}return e.create=(t,r)=>new xr(t,r),e})(),xr=class extends Ae{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,t)}error(t){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,t)}complete(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)}_subscribe(t){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&o!==void 0?o:qo}};var Wt=class extends Ae{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let r=super._subscribe(t);return!r.closed&&t.next(this._value),r}getValue(){let{hasError:t,thrownError:r,_value:o}=this;if(t)throw r;return this._throwIfClosed(),o}next(t){super.next(this._value=t)}};var qt={now(){return(qt.delegate||Date).now()},delegate:void 0};var zt=class extends Ae{constructor(t=1/0,r=1/0,o=qt){super(),this._bufferSize=t,this._windowTime=r,this._timestampProvider=o,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=r===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,r)}next(t){let{isStopped:r,_buffer:o,_infiniteTimeWindow:n,_timestampProvider:i,_windowTime:s}=this;r||(o.push(t),!n&&o.push(i.now()+s)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();let r=this._innerSubscribe(t),{_infiniteTimeWindow:o,_buffer:n}=this,i=n.slice();for(let s=0;s<i.length&&!t.closed;s+=o?1:2)t.next(i[s]);return this._checkFinalizedStatuses(t),r}_trimBuffer(){let{_bufferSize:t,_timestampProvider:r,_buffer:o,_infiniteTimeWindow:n}=this,i=(n?1:2)*t;if(t<1/0&&i<o.length&&o.splice(0,o.length-i),!n){let s=r.now(),a=0;for(let u=1;u<o.length&&o[u]<=s;u+=2)a=u;a&&o.splice(0,a+1)}}};function Ri(e,t,r,o){function n(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(c){try{l(o.next(c))}catch(f){s(f)}}function u(c){try{l(o.throw(c))}catch(f){s(f)}}function l(c){c.done?i(c.value):n(c.value).then(a,u)}l((o=o.apply(e,t||[])).next())})}function Ii(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function et(e){return this instanceof et?(this.v=e,this):new et(e)}function Ci(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=r.apply(e,t||[]),n,i=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),n[Symbol.asyncIterator]=function(){return this},n;function s(m){return function(d){return Promise.resolve(d).then(m,f)}}function a(m,d){o[m]&&(n[m]=function(y){return new Promise(function(b,x){i.push([m,y,b,x])>1||u(m,y)})},d&&(n[m]=d(n[m])))}function u(m,d){try{l(o[m](d))}catch(y){h(i[0][3],y)}}function l(m){m.value instanceof et?Promise.resolve(m.value.v).then(c,f):h(i[0][2],m)}function c(m){u("next",m)}function f(m){u("throw",m)}function h(m,d){m(d),i.shift(),i.length&&u(i[0][0],i[0][1])}}function Ti(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Ii=="function"?Ii(e):e[Symbol.iterator](),r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r);function o(i){r[i]=e[i]&&function(s){return new Promise(function(a,u){s=e[i](s),n(a,u,s.done,s.value)})}}function n(i,s,a,u){Promise.resolve(u).then(function(l){i({value:l,done:a})},s)}}var br=e=>e&&typeof e.length=="number"&&typeof e!="function";function _r(e){return E(e?.then)}function wr(e){return E(e[vt])}function Or(e){return Symbol.asyncIterator&&E(e?.[Symbol.asyncIterator])}function Er(e){return new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Pu(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Sr=Pu();function $r(e){return E(e?.[Sr])}function Ar(e){return Ci(this,arguments,function*(){let r=e.getReader();try{for(;;){let{value:o,done:n}=yield et(r.read());if(n)return yield et(void 0);yield yield et(o)}}finally{r.releaseLock()}})}function Ir(e){return E(e?.getReader)}function B(e){if(e instanceof R)return e;if(e!=null){if(wr(e))return ku(e);if(br(e))return Fu(e);if(_r(e))return Lu(e);if(Or(e))return Di(e);if($r(e))return Bu(e);if(Ir(e))return Uu(e)}throw Er(e)}function ku(e){return new R(t=>{let r=e[vt]();if(E(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Fu(e){return new R(t=>{for(let r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Lu(e){return new R(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,gr)})}function Bu(e){return new R(t=>{for(let r of e)if(t.next(r),t.closed)return;t.complete()})}function Di(e){return new R(t=>{ju(e,t).catch(r=>t.error(r))})}function Uu(e){return Di(Ar(e))}function ju(e,t){var r,o,n,i;return Ri(this,void 0,void 0,function*(){try{for(r=Ti(e);o=yield r.next(),!o.done;){let s=o.value;if(t.next(s),t.closed)return}}catch(s){n={error:s}}finally{try{o&&!o.done&&(i=r.return)&&(yield i.call(r))}finally{if(n)throw n.error}}t.complete()})}function ie(e,t,r,o=0,n=!1){let i=t.schedule(function(){r(),n?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(i),!n)return i}function Go(e){return E(e?.lift)}function $(e){return t=>{if(Go(t))return t.lift(function(r){try{return e(r,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function A(e,t,r,o,n){return new Jo(e,t,r,o,n)}var Jo=class extends Ze{constructor(t,r,o,n,i,s){super(t),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=r?function(a){try{r(a)}catch(u){t.error(u)}}:super._next,this._error=n?function(a){try{n(a)}catch(u){t.error(u)}finally{this.unsubscribe()}}:super._error,this._complete=o?function(){try{o()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:r}=this;super.unsubscribe(),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}}};function Rr(e,t=0){return $((r,o)=>{r.subscribe(A(o,n=>ie(o,e,()=>o.next(n),t),()=>ie(o,e,()=>o.complete(),t),n=>ie(o,e,()=>o.error(n),t)))})}function Cr(e,t=0){return $((r,o)=>{o.add(e.schedule(()=>r.subscribe(o),t))})}function Mi(e,t){return B(e).pipe(Cr(t),Rr(t))}function Ni(e,t){return B(e).pipe(Cr(t),Rr(t))}function Pi(e,t){return new R(r=>{let o=0;return t.schedule(function(){o===e.length?r.complete():(r.next(e[o++]),r.closed||this.schedule())})})}function ki(e,t){return new R(r=>{let o;return ie(r,t,()=>{o=e[Sr](),ie(r,t,()=>{let n,i;try{({value:n,done:i}=o.next())}catch(s){r.error(s);return}i?r.complete():r.next(n)},0,!0)}),()=>E(o?.return)&&o.return()})}function Tr(e,t){if(!e)throw new Error("Iterable cannot be null");return new R(r=>{ie(r,t,()=>{let o=e[Symbol.asyncIterator]();ie(r,t,()=>{o.next().then(n=>{n.done?r.complete():r.next(n.value)})},0,!0)})})}function Fi(e,t){return Tr(Ar(e),t)}function Li(e,t){if(e!=null){if(wr(e))return Mi(e,t);if(br(e))return Pi(e,t);if(_r(e))return Ni(e,t);if(Or(e))return Tr(e,t);if($r(e))return ki(e,t);if(Ir(e))return Fi(e,t)}throw Er(e)}function ye(e,t){return t?Li(e,t):B(e)}function Dr(e){return e&&E(e.schedule)}function Xo(e){return e[e.length-1]}function Mr(e){return E(Xo(e))?e.pop():void 0}function ge(e){return Dr(Xo(e))?e.pop():void 0}function Nr(e,t){return typeof Xo(e)=="number"?e.pop():t}function Zo(...e){let t=ge(e);return ye(e,t)}function J(e,t){return $((r,o)=>{let n=0;r.subscribe(A(o,i=>{o.next(e.call(t,i,n++))}))})}var{isArray:Vu}=Array,{getPrototypeOf:Wu,prototype:qu,keys:zu}=Object;function Pr(e){if(e.length===1){let t=e[0];if(Vu(t))return{args:t,keys:null};if(Hu(t)){let r=zu(t);return{args:r.map(o=>t[o]),keys:r}}}return{args:e,keys:null}}function Hu(e){return e&&typeof e=="object"&&Wu(e)===qu}var{isArray:Ku}=Array;function Qu(e,t){return Ku(t)?e(...t):e(t)}function kr(e){return J(t=>Qu(e,t))}function Fr(e,t){return e.reduce((r,o,n)=>(r[o]=t[n],r),{})}function Yu(...e){let t=ge(e),r=Mr(e),{args:o,keys:n}=Pr(e);if(o.length===0)return ye([],t);let i=new R(Gu(o,t,n?s=>Fr(n,s):te));return r?i.pipe(kr(r)):i}function Gu(e,t,r=te){return o=>{Bi(t,()=>{let{length:n}=e,i=new Array(n),s=n,a=n;for(let u=0;u<n;u++)Bi(t,()=>{let l=ye(e[u],t),c=!1;l.subscribe(A(o,f=>{i[u]=f,c||(c=!0,a--),a||o.next(r(i.slice()))},()=>{--s||o.complete()}))},o)},o)}}function Bi(e,t,r){e?ie(r,e,t):t()}function j(e,t){return $((r,o)=>{let n=0;r.subscribe(A(o,i=>e.call(t,i,n++)&&o.next(i)))})}function tt(e,t=te){return e=e??Ju,$((r,o)=>{let n,i=!0;r.subscribe(A(o,s=>{let a=t(s);(i||!e(n,a))&&(i=!1,n=a,o.next(s))}))})}function Ju(e,t){return e===t}function Ui(e={}){let{connector:t=()=>new Ae,resetOnError:r=!0,resetOnComplete:o=!0,resetOnRefCountZero:n=!0}=e;return i=>{let s,a,u,l=0,c=!1,f=!1,h=()=>{a?.unsubscribe(),a=void 0},m=()=>{h(),s=u=void 0,c=f=!1},d=()=>{let y=s;m(),y?.unsubscribe()};return $((y,b)=>{l++,!f&&!c&&h();let x=u=u??t();b.add(()=>{l--,l===0&&!f&&!c&&(a=en(d,n))}),x.subscribe(b),!s&&l>0&&(s=new Me({next:w=>x.next(w),error:w=>{f=!0,h(),a=en(m,r,w),x.error(w)},complete:()=>{c=!0,h(),a=en(m,o),x.complete()}}),B(y).subscribe(s))})(i)}}function en(e,t,...r){if(t===!0){e();return}if(t===!1)return;let o=new Me({next:()=>{o.unsubscribe(),e()}});return B(t(...r)).subscribe(o)}function xt(e,t,r){let o,n=!1;return e&&typeof e=="object"?{bufferSize:o=1/0,windowTime:t=1/0,refCount:n=!1,scheduler:r}=e:o=e??1/0,Ui({connector:()=>new zt(o,t,r),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:n})}function ji(e,t){return $((r,o)=>{let n=null,i=0,s=!1,a=()=>s&&!n&&o.complete();r.subscribe(A(o,u=>{n?.unsubscribe();let l=0,c=i++;B(e(u,c)).subscribe(n=A(o,f=>o.next(t?t(u,f,c,l++):f),()=>{n=null,a()}))},()=>{s=!0,a()}))})}function Xu(e){return $((t,r)=>{B(e).subscribe(A(r,()=>r.complete(),Je)),!r.closed&&t.subscribe(r)})}function tn(){return $((e,t)=>{let r=null;e._refCount++;let o=A(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount){r=null;return}let n=e._connection,i=r;r=null,n&&(!i||n===i)&&n.unsubscribe(),t.unsubscribe()});e.subscribe(o),o.closed||(r=e.connect())})}var rn=class extends R{constructor(t,r){super(),this.source=t,this.subjectFactory=r,this._subject=null,this._refCount=0,this._connection=null,Go(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){let t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new K;let r=this.getSubject();t.add(this.source.subscribe(A(r,void 0,()=>{this._teardown(),r.complete()},o=>{this._teardown(),r.error(o)},()=>this._teardown()))),t.closed&&(this._connection=null,t=K.EMPTY)}return t}refCount(){return tn()(this)}};var bt={schedule(e){let t=requestAnimationFrame,r=cancelAnimationFrame,{delegate:o}=bt;o&&(t=o.requestAnimationFrame,r=o.cancelAnimationFrame);let n=t(i=>{r=void 0,e(i)});return new K(()=>r?.(n))},requestAnimationFrame(...e){let{delegate:t}=bt;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){let{delegate:t}=bt;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0};var Lr=class extends K{constructor(t,r){super()}schedule(t,r=0){return this}};var Ht={setInterval(e,t,...r){let{delegate:o}=Ht;return o?.setInterval?o.setInterval(e,t,...r):setInterval(e,t,...r)},clearInterval(e){let{delegate:t}=Ht;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var Be=class extends Lr{constructor(t,r){super(t,r),this.scheduler=t,this.work=r,this.pending=!1}schedule(t,r=0){var o;if(this.closed)return this;this.state=t;let n=this.id,i=this.scheduler;return n!=null&&(this.id=this.recycleAsyncId(i,n,r)),this.pending=!0,this.delay=r,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(i,this.id,r),this}requestAsyncId(t,r,o=0){return Ht.setInterval(t.flush.bind(t,this),o)}recycleAsyncId(t,r,o=0){if(o!=null&&this.delay===o&&this.pending===!1)return r;r!=null&&Ht.clearInterval(r)}execute(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let o=this._execute(t,r);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,r){let o=!1,n;try{this.work(t)}catch(i){o=!0,n=i||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){let{id:t,scheduler:r}=this,{actions:o}=r;this.work=this.state=this.scheduler=null,this.pending=!1,Ge(o,this),t!=null&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,super.unsubscribe()}}};var Zu=1,on,nn={};function Vi(e){return e in nn?(delete nn[e],!0):!1}var Wi={setImmediate(e){let t=Zu++;return nn[t]=!0,on||(on=Promise.resolve()),on.then(()=>Vi(t)&&e()),t},clearImmediate(e){Vi(e)}};var{setImmediate:ec,clearImmediate:tc}=Wi,Kt={setImmediate(...e){let{delegate:t}=Kt;return(t?.setImmediate||ec)(...e)},clearImmediate(e){let{delegate:t}=Kt;return(t?.clearImmediate||tc)(e)},delegate:void 0};var Br=class extends Be{constructor(t,r){super(t,r),this.scheduler=t,this.work=r}requestAsyncId(t,r,o=0){return o!==null&&o>0?super.requestAsyncId(t,r,o):(t.actions.push(this),t._scheduled||(t._scheduled=Kt.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,r,o=0){var n;if(o!=null?o>0:this.delay>0)return super.recycleAsyncId(t,r,o);let{actions:i}=t;r!=null&&((n=i[i.length-1])===null||n===void 0?void 0:n.id)!==r&&(Kt.clearImmediate(r),t._scheduled===r&&(t._scheduled=void 0))}};var _t=class e{constructor(t,r=e.now){this.schedulerActionCtor=t,this.now=r}schedule(t,r=0,o){return new this.schedulerActionCtor(this,t).schedule(o,r)}};_t.now=qt.now;var Ue=class extends _t{constructor(t,r=_t.now){super(t,r),this.actions=[],this._active=!1}flush(t){let{actions:r}=this;if(this._active){r.push(t);return}let o;this._active=!0;do if(o=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,o){for(;t=r.shift();)t.unsubscribe();throw o}}};var Ur=class extends Ue{flush(t){this._active=!0;let r=this._scheduled;this._scheduled=void 0;let{actions:o}=this,n;t=t||o.shift();do if(n=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===r&&o.shift());if(this._active=!1,n){for(;(t=o[0])&&t.id===r&&o.shift();)t.unsubscribe();throw n}}};var rc=new Ur(Br);var sn=new Ue(Be),qi=sn;var jr=class extends Be{constructor(t,r){super(t,r),this.scheduler=t,this.work=r}requestAsyncId(t,r,o=0){return o!==null&&o>0?super.requestAsyncId(t,r,o):(t.actions.push(this),t._scheduled||(t._scheduled=bt.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,r,o=0){var n;if(o!=null?o>0:this.delay>0)return super.recycleAsyncId(t,r,o);let{actions:i}=t;r!=null&&((n=i[i.length-1])===null||n===void 0?void 0:n.id)!==r&&(bt.cancelAnimationFrame(r),t._scheduled=void 0)}};var Vr=class extends Ue{flush(t){this._active=!0;let r=this._scheduled;this._scheduled=void 0;let{actions:o}=this,n;t=t||o.shift();do if(n=t.execute(t.state,t.delay))break;while((t=o[0])&&t.id===r&&o.shift());if(this._active=!1,n){for(;(t=o[0])&&t.id===r&&o.shift();)t.unsubscribe();throw n}}};var oc=new Vr(jr);var rt=new R(e=>e.complete());function nc(e,t){let r=E(e)?e:()=>e,o=n=>n.error(r());return new R(t?n=>t.schedule(o,0,n):o)}function ic(e){return!!e&&(e instanceof R||E(e.lift)&&E(e.subscribe))}var ot=dt(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function zi(e){return e instanceof Date&&!isNaN(e)}function Hi(e,t,r,o,n,i,s,a){let u=[],l=0,c=0,f=!1,h=()=>{f&&!u.length&&!l&&t.complete()},m=y=>l<o?d(y):u.push(y),d=y=>{i&&t.next(y),l++;let b=!1;B(r(y,c++)).subscribe(A(t,x=>{n?.(x),i?m(x):t.next(x)},()=>{b=!0},void 0,()=>{if(b)try{for(l--;u.length&&l<o;){let x=u.shift();s?ie(t,s,()=>d(x)):d(x)}h()}catch(x){t.error(x)}}))};return e.subscribe(A(t,m,()=>{f=!0,h()})),()=>{a?.()}}function se(e,t,r=1/0){return E(t)?se((o,n)=>J((i,s)=>t(o,i,n,s))(B(e(o,n))),r):(typeof t=="number"&&(r=t),$((o,n)=>Hi(o,n,e,r)))}function nt(e=1/0){return se(te,e)}function Ki(){return nt(1)}function wt(...e){return Ki()(ye(e,ge(e)))}function sc(e){return new R(t=>{B(e()).subscribe(t)})}function ac(...e){let t=Mr(e),{args:r,keys:o}=Pr(e),n=new R(i=>{let{length:s}=r;if(!s){i.complete();return}let a=new Array(s),u=s,l=s;for(let c=0;c<s;c++){let f=!1;B(r[c]).subscribe(A(i,h=>{f||(f=!0,l--),a[c]=h},()=>u--,void 0,()=>{(!u||!f)&&(l||i.next(o?Fr(o,a):a),i.complete())}))}});return t?n.pipe(kr(t)):n}function Qi(e=0,t,r=qi){let o=-1;return t!=null&&(Dr(t)?r=t:o=t),new R(n=>{let i=zi(e)?+e-r.now():e;i<0&&(i=0);let s=0;return r.schedule(function(){n.closed||(n.next(s++),0<=o?this.schedule(void 0,o):n.complete())},i)})}function uc(e=0,t=sn){return e<0&&(e=0),Qi(e,e,t)}function an(...e){let t=ge(e),r=Nr(e,1/0),o=e;return o.length?o.length===1?B(o[0]):nt(r)(ye(o,t)):rt}var cc=new R(Je);var{isArray:lc}=Array;function Yi(e){return e.length===1&&lc(e[0])?e[0]:e}function Gi(e){return $((t,r)=>{let o=null,n=!1,i;o=t.subscribe(A(r,void 0,void 0,s=>{i=B(e(s,Gi(e)(t))),o?(o.unsubscribe(),o=null,i.subscribe(r)):n=!0})),n&&(o.unsubscribe(),o=null,i.subscribe(r))})}function Ji(e,t,r,o,n){return(i,s)=>{let a=r,u=t,l=0;i.subscribe(A(s,c=>{let f=l++;u=a?e(u,c,f):(a=!0,c),o&&s.next(u)},n&&(()=>{a&&s.next(u),s.complete()})))}}function fc(e,t){return E(t)?se(e,t,1):se(e,1)}function Qt(e){return $((t,r)=>{let o=!1;t.subscribe(A(r,n=>{o=!0,r.next(n)},()=>{o||r.next(e),r.complete()}))})}function un(e){return e<=0?()=>rt:$((t,r)=>{let o=0;t.subscribe(A(r,n=>{++o<=e&&(r.next(n),e<=o&&r.complete())}))})}function Wr(e=mc){return $((t,r)=>{let o=!1;t.subscribe(A(r,n=>{o=!0,r.next(n)},()=>o?r.complete():r.error(e())))})}function mc(){return new ot}function pc(...e){return t=>wt(t,Zo(...e))}function hc(e){return $((t,r)=>{try{t.subscribe(r)}finally{r.add(e)}})}function dc(e,t){let r=arguments.length>=2;return o=>o.pipe(e?j((n,i)=>e(n,i,o)):te,un(1),r?Qt(t):Wr(()=>new ot))}function cn(e){return e<=0?()=>rt:$((t,r)=>{let o=[];t.subscribe(A(r,n=>{o.push(n),e<o.length&&o.shift()},()=>{for(let n of o)r.next(n);r.complete()},void 0,()=>{o=null}))})}function yc(e,t){let r=arguments.length>=2;return o=>o.pipe(e?j((n,i)=>e(n,i,o)):te,cn(1),r?Qt(t):Wr(()=>new ot))}function Xi(...e){let t=ge(e),r=Nr(e,1/0);return e=Yi(e),$((o,n)=>{nt(r)(ye([o,...e],t)).subscribe(n)})}function gc(...e){return Xi(...e)}function vc(e,t){return $(Ji(e,t,arguments.length>=2,!0))}function Yt(...e){let t=ge(e);return $((r,o)=>{(t?wt(e,r,t):wt(e,r)).subscribe(o)})}function xc(e,t=!1){return $((r,o)=>{let n=0;r.subscribe(A(o,i=>{let s=e(i,n++);(s||t)&&o.next(i),!s&&o.complete()}))})}function bc(e,t,r){let o=E(e)||t||r?{next:e,error:t,complete:r}:e;return o?$((n,i)=>{var s;(s=o.subscribe)===null||s===void 0||s.call(o);let a=!0;n.subscribe(A(i,u=>{var l;(l=o.next)===null||l===void 0||l.call(o,u),i.next(u)},()=>{var u;a=!1,(u=o.complete)===null||u===void 0||u.call(o),i.complete()},u=>{var l;a=!1,(l=o.error)===null||l===void 0||l.call(o,u),i.error(u)},()=>{var u,l;a&&((u=o.unsubscribe)===null||u===void 0||u.call(o)),(l=o.finalize)===null||l===void 0||l.call(o)}))}):te}function Zi(e){return Array.isArray(e)?e.slice(0):[e]}function Ot(e){return Array.isArray(e)}function es(e){return e!=null}function qr(e,t){var r=0,o=-1;for(var n of e){o=o+1;var i=t(n,o);if(i)r=r+1;else break}return r}function Ne(e,t){var r=t.length;if(r!==0){var o=e.length;e.length=o+t.length;for(var n=0;n<r;++n)e[o+n]=t[n]}}function wx(e){return e.filter(function(t,r,o){return o.indexOf(t)===r})}var Ex=Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0});var Sx=Object.freeze(["prototype","__proto__","constructor"]);var _c="[native code] }",$x=_c.length;var wc=Object.defineProperty,Oc=(e,t,r)=>t in e?wc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Et=(e,t,r)=>(Oc(e,typeof t!="symbol"?t+"":t,r),r),je=class e{constructor(t,r){Et(this,"words"),Et(this,"sigBytes"),t=this.words=t||[],this.sigBytes=r===void 0?t.length*4:r}toString(t){return(t||Ec).stringify(this)}concat(t){if(this.clamp(),this.sigBytes%4)for(let r=0;r<t.sigBytes;r++){let o=t.words[r>>>2]>>>24-r%4*8&255;this.words[this.sigBytes+r>>>2]|=o<<24-(this.sigBytes+r)%4*8}else for(let r=0;r<t.sigBytes;r+=4)this.words[this.sigBytes+r>>>2]=t.words[r>>>2];return this.sigBytes+=t.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new e([...this.words])}},Ec={stringify(e){let t=[];for(let r=0;r<e.sigBytes;r++){let o=e.words[r>>>2]>>>24-r%4*8&255;t.push((o>>>4).toString(16),(o&15).toString(16))}return t.join("")}};var Sc={parse(e){let t=e.length,r=[];for(let o=0;o<t;o++)r[o>>>2]|=(e.charCodeAt(o)&255)<<24-o%4*8;return new je(r,t)}},$c={parse(e){return Sc.parse(unescape(encodeURIComponent(e)))}},ln=class{constructor(){Et(this,"_data",new je),Et(this,"_nDataBytes",0),Et(this,"_minBufferSize",0),Et(this,"blockSize",512/32)}reset(){this._data=new je,this._nDataBytes=0}_append(t){typeof t=="string"&&(t=$c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_doProcessBlock(t,r){}_process(t){let r,o=this._data.sigBytes/(this.blockSize*4);t?o=Math.ceil(o):o=Math.max((o|0)-this._minBufferSize,0);let n=o*this.blockSize,i=Math.min(n*4,this._data.sigBytes);if(n){for(let s=0;s<n;s+=this.blockSize)this._doProcessBlock(this._data.words,s);r=this._data.words.splice(0,n),this._data.sigBytes-=i}return new je(r,i)}},fn=class extends ln{update(t){return this._append(t),this._process(),this}finalize(t){t&&this._append(t)}},Ac=Object.defineProperty,Ic=(e,t,r)=>t in e?Ac(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Rc=(e,t,r)=>(Ic(e,typeof t!="symbol"?t+"":t,r),r),ts=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Cc=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],it=[],mn=class extends fn{constructor(){super(...arguments),Rc(this,"_hash",new je([...ts]))}reset(){super.reset(),this._hash=new je([...ts])}_doProcessBlock(t,r){let o=this._hash.words,n=o[0],i=o[1],s=o[2],a=o[3],u=o[4],l=o[5],c=o[6],f=o[7];for(let h=0;h<64;h++){if(h<16)it[h]=t[r+h]|0;else{let S=it[h-15],Z=(S<<25|S>>>7)^(S<<14|S>>>18)^S>>>3,M=it[h-2],z=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;it[h]=Z+it[h-7]+z+it[h-16]}let m=u&l^~u&c,d=n&i^n&s^i&s,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),b=(u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25),x=f+b+m+Cc[h]+it[h],w=y+d;f=c,c=l,l=u,u=a+x|0,a=s,s=i,i=n,n=x+w|0}o[0]=o[0]+n|0,o[1]=o[1]+i|0,o[2]=o[2]+s|0,o[3]=o[3]+a|0,o[4]=o[4]+u|0,o[5]=o[5]+l|0,o[6]=o[6]+c|0,o[7]=o[7]+f|0}finalize(t){super.finalize(t);let r=this._nDataBytes*8,o=this._data.sigBytes*8;return this._data.words[o>>>5]|=128<<24-o%32,this._data.words[(o+64>>>9<<4)+14]=Math.floor(r/4294967296),this._data.words[(o+64>>>9<<4)+15]=r,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}};function rs(e){return new mn().finalize(e).toString()}function Tc(e){return Promise.resolve(rs(e))}async function Dc(e){var t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t),o=Array.prototype.map.call(new Uint8Array(r),n=>("00"+n.toString(16)).slice(-2)).join("");return o}var Mc=typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof crypto.subtle.digest=="function",os=Mc?Dc:Tc;var ns="abcdefghijklmnopqrstuvwxyz";function st(e=10){for(var t="",r=0;r<e;r++)t+=ns.charAt(Math.floor(Math.random()*ns.length));return t}function zr(e){e+="";var t=e.charAt(0).toUpperCase();return t+e.substr(1)}function at(e){for(;e.charAt(0)===".";)e=e.substr(1);for(;e.slice(-1)===".";)e=e.slice(0,-1);return e}function Tx(e){return!!(e.includes("/")||e.includes("\\"))}function St(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,o;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(o=r;o--!==0;)if(!St(e[o],t[o]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var n=Object.keys(e);if(r=n.length,r!==Object.keys(t).length)return!1;for(o=r;o--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[o]))return!1;for(o=r;o--!==0;){var i=n[o];if(!St(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}var hn=e=>{var t=typeof e;return e!==null&&(t==="object"||t==="function")},pn=new Set(["__proto__","prototype","constructor"]),Nc=new Set("0123456789");function is(e){var t=[],r="",o="start",n=!1;for(var i of e)switch(i){case"\\":{if(o==="index")throw new Error("Invalid character in an index");if(o==="indexEnd")throw new Error("Invalid character after an index");n&&(r+=i),o="property",n=!n;break}case".":{if(o==="index")throw new Error("Invalid character in an index");if(o==="indexEnd"){o="property";break}if(n){n=!1,r+=i;break}if(pn.has(r))return[];t.push(r),r="",o="property";break}case"[":{if(o==="index")throw new Error("Invalid character in an index");if(o==="indexEnd"){o="index";break}if(n){n=!1,r+=i;break}if(o==="property"){if(pn.has(r))return[];t.push(r),r=""}o="index";break}case"]":{if(o==="index"){t.push(Number.parseInt(r,10)),r="",o="indexEnd";break}if(o==="indexEnd")throw new Error("Invalid character after an index")}default:{if(o==="index"&&!Nc.has(i))throw new Error("Invalid character in an index");if(o==="indexEnd")throw new Error("Invalid character after an index");o==="start"&&(o="property"),n&&(n=!1,r+="\\"),r+=i}}switch(n&&(r+="\\"),o){case"property":{if(pn.has(r))return[];t.push(r);break}case"index":throw new Error("Index was not closed");case"start":{t.push("");break}}return t}function ss(e,t){if(typeof t!="number"&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function Pc(e,t){if(ss(e,t))throw new Error("Cannot use string index")}function $t(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!hn(e)||typeof t!="string")return r===void 0?e:r;var o=is(t);if(o.length===0)return r;for(var n=0;n<o.length;n++){var i=o[n];if(ss(e,i)?e=n===o.length-1?void 0:null:e=e[i],e==null){if(n!==o.length-1)return r;break}}return e===void 0?r:e}function Nx(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!hn(e)||typeof t!="string")return e;for(var o=e,n=is(t),i=0;i<n.length;i++){var s=n[i];Pc(e,s),i===n.length-1?e[s]=r:hn(e[s])||(e[s]=typeof n[i+1]=="number"?[]:{}),e=e[s]}return o}var dn="15.39.0";var Fx={},Lx="6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93";function ut(e){for(var t="",r=0;r<e.length;r++){var o=e[r];if(o==="-")return parseInt(t,10);t+=o}throw new Error("malformatted revision: "+e)}function At(e,t){var r=t?ut(t._rev)+1:1;return r+"-"+e}var Hr=1;function Ve(){return{lwt:Hr}}function Pe(){return""}function as(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}function us(e,t,r){if(t.length!==r.length)return!1;for(var o=0,n=t.length;o<n;){var i=t[o],s=r[o];if(o++,i._rev!==s._rev||i[e]!==s[e])return!1}return!0}function cs(){return new Promise(e=>setTimeout(e,0))}function ls(e=0){return new Promise(t=>setTimeout(t,e))}var kc=Promise.resolve(!0),Ie=Promise.resolve(!1),fs=Promise.resolve(null),It=Promise.resolve();function Rt(e=1e4){return typeof requestIdleCallback=="function"?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):ls(0)}var yn=It;function ms(e=void 0){return yn=yn.then(()=>Rt(e)),yn}function ps(e,t){return e.reduce((r,o)=>r.then(o),Promise.resolve(t))}var hs=/\./g;function We(e,t){var r=e.get(t);if(typeof r>"u")throw new Error("missing value from map "+t);return r}function we(e,t,r,o){var n=e.get(t);return typeof n>"u"?(n=r(),e.set(t,n)):o&&o(n),n}function D(e){var t=e.split("-"),r="RxDB";return t.forEach(o=>{r+=zr(o)}),r+="Plugin",new Error(`You are using a function which must be overwritten by a plugin.
        You should either prevent the usage of this function or add the plugin via:
            import { `+r+" } from 'rxdb/plugins/"+e+`';
            addRxPlugin(`+r+`);
        `)}var gn=0;function re(){var e=Date.now();e=e+.01,e<=gn&&(e=gn+.01);var t=parseFloat(e.toFixed(2));return gn=t,t}function k(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var Kr={bufferSize:1,refCount:!0};function ct(e,t){var r=t;r=r.replace(hs,".properties."),r="properties."+r,r=at(r);var o=$t(e,r);return o}function ds(e,t,r){if(typeof t.primaryKey=="string")return r;var o=Gt(t,r),n=r[e];if(n&&n!==o)throw _("DOC19",{args:{documentData:r,existingPrimary:n,newPrimary:o},schema:t});return r[e]=o,r}function qe(e){return typeof e=="string"?e:e.key}function Gt(e,t){if(typeof e.primaryKey=="string")return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(o=>{var n=$t(t,o);if(typeof n>"u")throw _("DOC18",{args:{field:o,documentData:t}});return n}).join(r.separator)}function ys(e){var t=ht(e,!0);return t}function Fc(e){return["_deleted",e]}function Qr(e){e=q(e);var t=qe(e.primaryKey);e.properties=q(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=Lc,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=vn(e);Ne(e.required,r),e.required=e.required.filter(i=>!i.includes(".")).filter((i,s,a)=>a.indexOf(i)===s),e.version=e.version||0;var o=e.indexes.map(i=>{var s=Ot(i)?i.slice(0):[i];return s.includes(t)||s.push(t),s[0]!=="_deleted"&&s.unshift("_deleted"),s});o.length===0&&o.push(Fc(t)),o.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(i=>{o.push(i)});var n=new Set;return o.filter(i=>{var s=i.join(",");return n.has(s)?!1:(n.add(s),!0)}),e.indexes=o,e}var Lc={type:"object",properties:{lwt:{type:"number",minimum:Hr,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function vn(e){var t=Object.keys(e.properties).filter(o=>e.properties[o].final),r=qe(e.primaryKey);return t.push(r),typeof e.primaryKey!="string"&&e.primaryKey.fields.forEach(o=>t.push(o)),t}function gs(e,t){for(var r=Object.keys(e.defaultValues),o=0;o<r.length;++o){var n=r[o];(!Object.prototype.hasOwnProperty.call(t,n)||typeof t[n]>"u")&&(t[n]=e.defaultValues[n])}return t}var xn={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function Q(e,t){xn[e].length>0&&xn[e].forEach(r=>r(t))}function ze(e,t){return Promise.all(xn[e].map(r=>r(t)))}var Bc=function(){function e(r,o){this.jsonSchema=r,this.hashFunction=o,this.indexes=Uc(this.jsonSchema),this.primaryPath=qe(this.jsonSchema.primaryKey),this.finalFields=vn(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(o,n){this.finalFields.forEach(i=>{if(!St(o[i],n[i]))throw _("DOC9",{dataBefore:o,dataAfter:n,fieldName:i,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var o={},n=ct(this.jsonSchema,"");return Object.keys(n).forEach(i=>{var s=i;o.__defineGetter__(i,function(){if(!(!this.get||typeof this.get!="function")){var a=this.get(s);return a}}),Object.defineProperty(o,i+"$",{get:function(){return this.get$(s)},enumerable:!1,configurable:!1}),Object.defineProperty(o,i+"$$",{get:function(){return this.get$$(s)},enumerable:!1,configurable:!1}),Object.defineProperty(o,i+"_",{get:function(){return this.populate(s)},enumerable:!1,configurable:!1})}),le(this,"getDocumentPrototype",()=>o),o},t.getPrimaryOfDocumentData=function(o){return Gt(this.jsonSchema,o)},ee(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var r={};return Object.entries(this.jsonSchema.properties).filter(([,o])=>Object.prototype.hasOwnProperty.call(o,"default")).forEach(([o,n])=>r[o]=n.default),le(this,"defaultValues",r)}},{key:"hash",get:function(){return le(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function Uc(e){return(e.indexes||[]).map(t=>Ot(t)?t:[t])}function ib(e){var t=e.version?e.version:0,r=0;return new Array(t).fill(0).map(()=>r++)}function vs(e,t,r=!0){r&&Q("preCreateRxSchema",e);var o=Qr(e);o=ys(o),F.deepFreezeWhenDevMode(o);var n=new Bc(o,t);return Q("createRxSchema",n),n}function Yr(e){return e[e.length-1]}function jc(e){let t=typeof e;return e!==null&&(t==="object"||t==="function")}function bn(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!jc(e)||typeof t!="string")return r===void 0?e:r;let o=t.split(".");if(o.length===0)return r;for(let n=0;n<o.length;n++){let i=o[n];if(Vc(e,i)?e=n===o.length-1?void 0:null:e=e[i],e==null){if(n!==o.length-1)return r;break}}return e===void 0?r:e}function Vc(e,t){if(typeof t!="number"&&Array.isArray(e)){let r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}var _n=e=>!!e.queryParams.limit,xs=e=>e.queryParams.limit===1,bs=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),_s=e=>e.changeEvent.operation==="DELETE",ws=e=>e.changeEvent.operation==="INSERT",Os=e=>e.changeEvent.operation==="UPDATE",Es=e=>_n(e)&&e.previousResults.length>=e.queryParams.limit,Ss=e=>{let t=e.queryParams.sortFields,r=e.changeEvent.previous,o=e.changeEvent.doc;if(!o)return!1;if(!r)return!0;for(let n=0;n<t.length;n++){let i=t[n],s=bn(r,i),a=bn(o,i);if(s!==a)return!0}return!1},$s=e=>{let t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{let r=e.queryParams.primaryKey,o=e.previousResults;for(let n=0;n<o.length;n++)if(o[n][r]===t)return!0;return!1}},As=e=>{let t=e.previousResults[0];return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Is=e=>{let t=Yr(e.previousResults);return!!(t&&t[e.queryParams.primaryKey]===e.changeEvent.id)},Rs=e=>{let t=e.changeEvent.previous;if(!t)return!1;let r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Cs=e=>{let t=e.changeEvent.previous;if(!t)return!1;let r=Yr(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Ts=e=>{let t=e.changeEvent.doc;if(!t)return!1;let r=e.previousResults[0];return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)<0:!1},Ds=e=>{let t=e.changeEvent.doc;if(!t)return!1;let r=Yr(e.previousResults);return r?r[e.queryParams.primaryKey]===e.changeEvent.id?!0:e.queryParams.sortComparator(t,r)>0:!1},Ms=e=>{let t=e.changeEvent.previous;return t?e.queryParams.queryMatcher(t):!1},Ns=e=>{let t=e.changeEvent.doc;return t?e.queryParams.queryMatcher(t):!1},Ps=e=>e.previousResults.length===0;var ks={0:ws,1:Os,2:_s,3:_n,4:xs,5:bs,6:Ps,7:Es,8:As,9:Is,10:Ss,11:$s,12:Rs,13:Cs,14:Ts,15:Ds,16:Ms,17:Ns};function Fs(e,t,r,o){var n=e.length,i=n-1,s=0;if(n===0)return e.push(t),0;for(var a;o<=i;)s=o+(i-o>>1),a=e[s],r(a,t)<=0?o=s+1:i=s-1;return r(a,t)<=0&&s++,e.splice(s,0,t),s}var Ls=e=>{},Gr=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Jr=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Xr=e=>{let t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Zr=e=>{let t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Bs=e=>{Xr(e),Jr(e)},Us=e=>{Zr(e),Gr(e)},js=e=>{Xr(e),Gr(e)},Vs=e=>{Zr(e),Jr(e)},wn=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);let t=e.queryParams.primaryKey,r=e.previousResults;for(let o=0;o<r.length;o++)if(r[o][t]===e.changeEvent.id){r.splice(o,1);break}},Ws=e=>{let t=e.changeEvent.doc,r=e.queryParams.primaryKey,o=e.previousResults;for(let n=0;n<o.length;n++)if(o[n][r]===e.changeEvent.id){o[n]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},qs=e=>{let t={_id:"wrongHuman"+new Date().getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},On=e=>{let t=e.changeEvent.id,r=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,r)}else if(e.previousResults.find(n=>n[e.queryParams.primaryKey]===t))return;Fs(e.previousResults,r,e.queryParams.sortComparator,0)},zs=e=>{wn(e),On(e)},Hs=e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},Ks=e=>{throw new Error("Action unknownAction should never be called")};var Qs=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],Ys={doNothing:Ls,insertFirst:Gr,insertLast:Jr,removeFirstItem:Xr,removeLastItem:Zr,removeFirstInsertLast:Bs,removeLastInsertFirst:Us,removeFirstInsertFirst:js,removeLastInsertLast:Vs,removeExisting:wn,replaceExisting:Ws,alwaysWrong:qs,insertAtSortPosition:On,removeExistingAndInsertAtSortPosition:zs,runFullQueryAgain:Hs,unknownAction:Ks};function eo(e){return e.charCodeAt(0)-40}function Gs(e){return e?"1":"0"}function Wc(e=6){let t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=r.length;for(let n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*o));return t}var bb=Wc(4);function En(e,t){let r=[];for(let o=0,n=e.length;o<n;o+=t)r.push(e.substring(o,o+t));return r}function Js(e){let t=new Map,o=2+parseInt(e.charAt(0)+e.charAt(1),10)*2,n=e.substring(2,o),i=En(n,2);for(let y=0;y<i.length;y++){let b=i[y],x=b.charAt(0),w=eo(b.charAt(1));t.set(x,w)}let s=e.substring(o,e.length-3),a=En(s,4);for(let y=0;y<a.length;y++){let b=a[y],x=b.charAt(0),w=b.charAt(1),S=b.charAt(2),Z=eo(b.charAt(3));if(!t.has(w))throw new Error("missing node with id "+w);if(!t.has(S))throw new Error("missing node with id "+S);let M=t.get(w),z=t.get(S),P={l:Z,0:M,1:z};t.set(x,P)}let u=e.slice(-3),l=u.charAt(0),c=u.charAt(1),f=eo(u.charAt(2)),h=t.get(l),m=t.get(c);return{l:f,0:h,1:m}}function Xs(e,t,r){let o=e,n=e.l;for(;;){let i=t[n](r),s=Gs(i);if(o=o[s],typeof o=="number"||typeof o=="string")return o;n=o.l}}var qc="14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9\x7Fae9\xA1bf9\xA2bq9\xA3cg9\xA4ck9\xA5cn9\xA6nd9\xA7np9\xA8nq9\xA9nf9\xAAng9\xABnm9\xACnk9\xADmr9\xAEms9\xAFmt9\xB0mj9\xB1mk9\xB2ml9\xB3mn9\xB4mc8\xB5\xB3{8\xB6\xAF}8\xB7\xB0\xA48\xB8\xB3\xA78\xB9mn8\xBA\xB3\xAB8\xBB\xB3m8\xBCm\xB44\xBDz\xB24\xBE\xB3w4\xBFz\xB54\xC0\xAF\xB64\xC1\xB0\xB74\xC2\xB3\xBA4\xC3\xB3\xB84\xC4m\xB94\xC5v\xA47\xC6yn7\xC7\xC0\xC17\xC8~\x7F7\xC9\xA5\xA47\xCA\xC3\xC47\xCB\xA8n7\xCC\xBA\xB97\xCD\xAD\xB07\xCE\xAEm7\xCF\xAF\xB07\xD0\xB1m7\xD1\xB3m7\xD2\xBCm5\xD3\xC4m5\xD4\xB9m5\xD5\xBD\xB05\xD6\xBEm5\xD7\xBF\xB05\xD8\xC7\xCF5\xD9\xC2m5\xDA\xCA\xD15\xDB\xB1m5\xDC\xBAm5\xDD\xCC\xD15\xDE\xD5\xCD2\xDF|\x7F2\xE0\xA1u2\xE1\xA3\xC52\xE2\xD6\xCE2\xE3\xA6\xC62\xE4\xA9x2\xE5\xAA\xC62\xE6\xD7\xD82\xE7|\xC82\xE8\xA1\xA22\xE9\xA3\xC92\xEA\xA4\xA52\xEB\xD9\xDA2\xEC\xA6\xCB2\xED\xA9n2\xEE\xAAn2\xEF\xDB\xD02\xF0\xDC\xDD2\xF1\xACn2\xF2\xD2\xD3/\xF3an/\xF4bn/\xF5cn/\xF6\xDE\xE2/\xF7\xDF\xE3/\xF8\xE0\xE4/\xF9\xE1\xE5/\xFA\xE6\xEB/\xFB\xE7\xEC/\xFC\xE8\xED/\xFD\xE9\xEE/\xFE\xCD\xCE/\xFF\xCF\xD1/\u0100\xF2\xD4,\u0101cn,\u0102\xF6\xEF,\u0103\xA4\xF1,\u0104\xFA\xF0,\u0105\xEA\xF1,\u0106\xFE\xD0,\u0107\xFF\xD1,\u0108ac0\u0109bc0\u010A\xF3\xF50\u010B\xF4\u01010\u010C\xDF\xE10\u010D\xE0\xA40\u010E\xE7\xE90\u010F\xE8\xEA0\u0110\xF7\xF90\u0111\xF8\u01030\u0112\xFB\xFD0\u0113\xFC\u01050\u0114m\xD2-\u0115m\u0100-\u0116\xDE\xE6-\u0117\u010C\u010E-\u0118\u010D\u010F-\u0119\u0102\u0104-\u011A\u0110\u0112-\u011B\u0111\u0113-\u011C\xB2\xBB-\u011D\xCD\xCF-\u011E\u0106\u0107-\u011F\xB2\xB3-\u0120\u0114\u01083\u0121\u0115\u010A3\u0122\u0116\u01173\u0123\u0119\u011A3\u0124\u0122\u011D(\u0125\u011C\u011F(\u0126\u0123\u011E(\u0127\u0120\u0121+\u0128\u0109\u010B+\u0129\u0124\u0126+\u012A\u0118\u011B+\u012B\u0127\u01281\u012C\u0129\u012A1\u012D\u012C\u012B*\u012E\u0125m*\u012D\u012E.",Sn;function zc(){return Sn||(Sn=Js(qc)),Sn}var Zs=e=>Xs(zc(),ks,e);function ea(e){let t=Zs(e);return Qs[t]}function ta(e,t,r,o,n){let i=Ys[e];return i({queryParams:t,changeEvent:r,previousResults:o,keyDocumentMap:n}),o}function ra(e){return e.documentData?e.documentData:e.previousDocumentData}function oa(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:F.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}var Jt="\uFFFF",Xt=Number.MIN_SAFE_INTEGER;function na(e,t){var r=t.selector,o=e.indexes?e.indexes.slice(0):[];t.index&&(o=[t.index]);var n=!!t.sort.find(c=>Object.values(c)[0]==="desc"),i=new Set;Object.keys(r).forEach(c=>{var f=ct(e,c);f&&f.type==="boolean"&&Object.prototype.hasOwnProperty.call(r[c],"$eq")&&i.add(c)});var s=t.sort.map(c=>Object.keys(c)[0]),a=s.filter(c=>!i.has(c)).join(","),u=-1,l;if(o.forEach(c=>{var f=!0,h=!0,m=c.map(w=>{var S=r[w],Z=S?Object.keys(S):[],M={};if(!S||!Z.length){var z=h?Xt:Jt;M={startKey:z,endKey:f?Jt:Xt,inclusiveStart:!0,inclusiveEnd:!0}}else Z.forEach(P=>{if(to.has(P)){var W=S[P],ne=Yc(P,W);M=Object.assign(M,ne)}});return typeof M.startKey>"u"&&(M.startKey=Xt),typeof M.endKey>"u"&&(M.endKey=Jt),typeof M.inclusiveStart>"u"&&(M.inclusiveStart=!0),typeof M.inclusiveEnd>"u"&&(M.inclusiveEnd=!0),h&&!M.inclusiveStart&&(h=!1),f&&!M.inclusiveEnd&&(f=!1),M}),d=m.map(w=>w.startKey),y=m.map(w=>w.endKey),b={index:c,startKeys:d,endKeys:y,inclusiveEnd:f,inclusiveStart:h,sortSatisfiedByIndex:!n&&a===c.filter(w=>!i.has(w)).join(","),selectorSatisfiedByIndex:Qc(c,t.selector,d,y)},x=Gc(e,t,b);(x>=u||t.index)&&(u=x,l=b)}),!l)throw _("SNH",{query:t});return l}var to=new Set(["$eq","$gt","$gte","$lt","$lte"]),Hc=new Set(["$eq","$gt","$gte"]),Kc=new Set(["$eq","$lt","$lte"]);function Qc(e,t,r,o){var n=Object.entries(t),i=n.find(([P,W])=>{if(!e.includes(P))return!0;var ne=Object.entries(W).find(([Ke,Lo])=>!to.has(Ke));return ne});if(i||t.$and||t.$or)return!1;var s=[],a=new Set;for(var[u,l]of Object.entries(t)){if(!e.includes(u))return!1;var c=Object.keys(l).filter(P=>Hc.has(P));if(c.length>1)return!1;var f=c[0];if(f&&a.add(u),f!=="$eq"){if(s.length>0)return!1;s.push(f)}}var h=[],m=new Set;for(var[d,y]of Object.entries(t)){if(!e.includes(d))return!1;var b=Object.keys(y).filter(P=>Kc.has(P));if(b.length>1)return!1;var x=b[0];if(x&&m.add(d),x!=="$eq"){if(h.length>0)return!1;h.push(x)}}var w=0;for(var S of e){for(var Z of[a,m]){if(!Z.has(S)&&Z.size>0)return!1;Z.delete(S)}var M=r[w],z=o[w];if(M!==z&&a.size>0&&m.size>0)return!1;w++}return!0}function Yc(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}function Gc(e,t,r){var o=0,n=c=>{c>0&&(o=o+c)},i=10,s=qr(r.startKeys,c=>c!==Xt&&c!==Jt);n(s*i);var a=qr(r.startKeys,c=>c!==Jt&&c!==Xt);n(a*i);var u=qr(r.startKeys,(c,f)=>c===r.endKeys[f]);n(u*i*1.5);var l=r.sortSatisfiedByIndex?5:0;return n(l),o}var X=class extends Error{},so=2147483647,ao=-2147483648,Rn=Number.MAX_SAFE_INTEGER,Cn=Number.MIN_SAFE_INTEGER,lt=Symbol("missing"),ua=Object.freeze(new Error("mingo: cycle detected while processing object/array")),Jc="[object Object]",Xc=/^\[object ([a-zA-Z0-9]+)\]$/,uo=e=>{let t=ol(e),r=0,o=t.length;for(;o;)r=(r<<5)-r^t.charCodeAt(--o);return r>>>0},ca=new Set(["null","undefined","boolean","number","string","date","regexp"]),Zc={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},H=(e,t)=>{e===lt&&(e=void 0),t===lt&&(t=void 0);let[r,o]=[e,t].map(n=>Zc[He(n).toLowerCase()]);return r!==o?r-o:r===1||r===2||r===6?e<t?-1:e>t?1:0:me(e,t)?0:e<t?-1:e>t?1:0};function g(e,t){if(!e)throw new X(t)}var He=e=>Xc.exec(Object.prototype.toString.call(e))[1],Zt=e=>typeof e=="boolean",T=e=>typeof e=="string";var I=e=>!isNaN(e)&&typeof e=="number";var O=Array.isArray,C=e=>{if(!e)return!1;let t=Object.getPrototypeOf(e);return(t===Object.prototype||t===null)&&Jc===Object.prototype.toString.call(e)},er=e=>e===Object(e),Tt=e=>e instanceof Date,Dt=e=>e instanceof RegExp,co=e=>typeof e=="function",v=e=>e==null,Re=(e,t)=>e.includes(t),lo=(e,t)=>!Re(e,t),Ce=(e,t=!0)=>!!e||t&&e==="",fe=e=>v(e)||T(e)&&!e||e instanceof Array&&e.length===0||C(e)&&Object.keys(e).length===0,ia=e=>e===lt,ke=e=>e instanceof Array?e:[e],ae=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),Tn=e=>typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e),el=[Tt,Dt,Tn],An=(e,t)=>{if(v(e))return e;if(t.has(e))throw ua;let r=e.constructor;if(el.some(o=>o(e)))return new r(e);try{if(t.add(e),O(e))return e.map(o=>An(o,t));if(C(e)){let o={};for(let n in e)o[n]=An(e[n],t);return o}}finally{t.delete(e)}return e},fo=e=>An(e,new Set),tl=(e,t)=>C(e)&&C(t)||O(e)&&O(t);function oo(e,t,r){if(r=r||{flatten:!1},ia(e)||v(e))return t;if(ia(t)||v(t))return e;if(!tl(e,t)){if(r.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(r.skipValidation=!0,O(e)){let o=e,n=t;if(r.flatten){let i=0,s=0;for(;i<o.length&&s<n.length;)o[i]=oo(o[i++],n[s++],r);for(;s<n.length;)o.push(t[s++])}else ve(o,n)}else for(let o in t)e[o]=oo(e[o],t[o],r);return e}function sa(e,t=uo){let r=new Map;return e.forEach((o,n)=>{let i=mo(o,t);r.has(i)?r.get(i).some(s=>me(e[s],o))||r.get(i).push(n):r.set(i,[n])}),r}function ft(e,t=uo){if(e.some(a=>a.length==0))return[];if(e.length===1)return Array.from(e);let r=la(e.map((a,u)=>[u,a.length]),a=>a[1]),o=e[r[0][0]],n=sa(o,t),i=new Map,s=new Array;return n.forEach((a,u)=>{let l=a.map(m=>o[m]),c=l.map(m=>0),f=l.map(m=>[r[0][0],0]),h=!1;for(let m=1;m<e.length;m++){let[d,y]=r[m],b=e[d];if(i.has(m)||i.set(m,sa(b)),i.get(m).has(u)){let x=i.get(m).get(u).map(w=>b[w]);h=l.map((w,S)=>x.some((Z,M)=>{let z=c[S];return me(w,Z)&&(c[S]++,d<f[S][0]&&(f[S]=[d,i.get(m).get(u)[M]])),z<c[S]})).some(Boolean)}if(!h)return}h&&ve(s,c.map((m,d)=>m===e.length-1?[l[d],f[d]]:lt).filter(m=>m!==lt))}),s.sort((a,u)=>{let[l,[c,f]]=a,[h,[m,d]]=u,y=H(c,m);return y!==0?y:H(f,d)}).map(a=>a[0])}function Dn(e,t=0){let r=new Array;function o(n,i){for(let s=0,a=n.length;s<a;s++)O(n[s])&&(i>0||i<0)?o(n[s],Math.max(-1,i-1)):r.push(n[s])}return o(e,t),r}var rl=e=>{let[t,r]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],o=t;for(;!r.length&&t!==Object.prototype&&t!==Array.prototype;)o=t,r=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);let n={};return r.forEach(i=>n[i]=e[i]),[n,o]};function me(e,t){if(e===t||Object.is(e,t))return!0;let r=!!e&&e.constructor||e;if(e===null||t===null||e===void 0||t===void 0||r!==t.constructor||r===Function)return!1;if(r===Array||r===Object){let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length||new Set([...i,...s]).size!=i.length)return!1;for(let a of i)if(!me(e[a],t[a]))return!1;return!0}let o=Object.getPrototypeOf(e);return(Tn(e)||o!==Object.prototype&&o!==Array.prototype&&Object.prototype.hasOwnProperty.call(o,"toString"))&&e.toString()===t.toString()}var ro=(e,t)=>{if(e===null)return"null";if(e===void 0)return"undefined";let r=e.constructor;switch(r){case RegExp:case Number:case Boolean:case Function:case Symbol:return e.toString();case String:return JSON.stringify(e);case Date:return e.toISOString()}if(Tn(e))return r.name+"["+e.toString()+"]";if(t.has(e))throw ua;try{if(t.add(e),O(e))return"["+e.map(s=>ro(s,t)).join(",")+"]";if(r===Object)return"{"+Object.keys(e).sort().map(s=>s+":"+ro(e[s],t)).join(",")+"}";let o=Object.getPrototypeOf(e);if(o!==Object.prototype&&o!==Array.prototype&&Object.prototype.hasOwnProperty.call(o,"toString"))return r.name+"("+JSON.stringify(e.toString())+")";let[n,i]=rl(e);return r.name+ro(n,t)}finally{t.delete(e)}},ol=e=>ro(e,new Set);function mo(e,t){return t=t||uo,v(e)?null:t(e).toString()}function la(e,t,r=H){if(fe(e))return e;let o=new Array,n=new Array;for(let i=0;i<e.length;i++){let s=e[i],a=t(s,i);v(a)?n.push(s):o.push([a,s])}return o.sort((i,s)=>r(i[0],s[0])),ve(n,o.map(i=>i[1]))}function po(e,t,r=uo){if(e.length<1)return new Map;let o=new Map,n=new Map;for(let i=0;i<e.length;i++){let s=e[i],a=t(s,i),u=mo(a,r);if(u===null)n.has(null)?n.get(null).push(s):n.set(null,[s]);else{let l=o.has(u)?o.get(u).find(c=>me(c,a)):null;v(l)?(n.set(a,[s]),o.has(u)?o.get(u).push(a):o.set(u,[a])):n.get(l).push(s)}}return n}var $n=5e4;function ve(e,...t){return e instanceof Array?t.reduce((r,o)=>{let n=Math.ceil(o.length/$n),i=0;for(;n-- >0;)Array.prototype.push.apply(r,o.slice(i,i+$n)),i+=$n;return r},e):t.filter(er).reduce((r,o)=>(Object.assign(r,o),r),e)}function In(e,t){return er(e)?e[t]:void 0}function nl(e,t){if(t<1)return e;for(;t--&&e.length===1;)e=e[0];return e}function Fe(e,t,r){let o=0;function n(s,a){let u=s;for(let l=0;l<a.length;l++){let c=a[l];if(/^\d+$/.exec(c)===null&&u instanceof Array){if(l===0&&o>0)break;o+=1;let h=a.slice(l);u=u.reduce((m,d)=>{let y=n(d,h);return y!==void 0&&m.push(y),m},[]);break}else u=In(u,c);if(u===void 0)break}return u}let i=ca.has(He(e).toLowerCase())?e:n(e,t.split("."));return i instanceof Array&&r?.unwrapArray?nl(i,o):i}function Ct(e,t,r){let o=t.split("."),n=o[0],i=o.slice(1).join("."),s=/^\d+$/.exec(n)!==null,a=o.length>1,u,l;if(e instanceof Array)if(s)u=In(e,Number(n)),a&&(u=Ct(u,i,r)),u=[u];else{u=[];for(let c of e)l=Ct(c,t,r),r?.preserveMissing?(l===void 0&&(l=lt),u.push(l)):l!==void 0&&u.push(l)}else{if(l=In(e,n),a&&(l=Ct(l,i,r)),l===void 0)return;u=r?.preserveKeys?U({},e):{},u[n]=l}return u}function no(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===lt?e.splice(t,1):no(e[t]);else if(C(e))for(let t in e)ae(e,t)&&no(e[t])}var aa=/^\d+$/;function io(e,t,r,o){let n=t.split("."),i=n[0],s=n.slice(1).join(".");if(n.length===1)(C(e)||O(e)&&aa.test(i))&&r(e,i);else{o?.buildGraph&&v(e[i])&&(e[i]={});let a=e[i];if(!a)return;let u=!!(n.length>1&&aa.test(n[1]));a instanceof Array&&o?.descendArray&&!u?a.forEach(l=>io(l,s,r,o)):io(a,s,r,o)}}function ho(e,t,r){io(e,t,(o,n)=>{o[n]=co(r)?r(o[n]):r},{buildGraph:!0})}function tr(e,t,r){io(e,t,(o,n)=>{if(o instanceof Array){if(/^\d+$/.test(n))o.splice(parseInt(n),1);else if(r&&r.descendArray)for(let i of o)C(i)&&delete i[n]}else C(o)&&delete o[n]},r)}var il=/^\$[a-zA-Z0-9_]+$/;function Oe(e){return il.test(e)}function yo(e){if(ca.has(He(e).toLowerCase()))return Dt(e)?{$regex:e}:{$eq:e};if(er(e)){if(!Object.keys(e).some(Oe))return{$eq:e};if(ae(e,"$regex")){let r=U({},e);return r.$regex=new RegExp(e.$regex,e.$options),delete r.$options,r}}return e}var pt=(e=>(e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF",e))(pt||{}),V=class e{constructor(t,r,o,n=Date.now()){this._opts=t,this._root=r,this._local=o,this.timestamp=n,this.update(r,o)}static init(t,r,o){return t instanceof e?new e(t._opts,v(t.root)?r:t.root,Object.assign({},t.local,o)):new e(t,r,o)}update(t,r){return this._root=t,this._local=r&&Object.assign({},r,{variables:Object.assign({},this._local?.variables,r?.variables)}),this}getOptions(){return Object.freeze(G(U({},this._opts),{context:Mt.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){return this._opts?.collation}get processingMode(){return this._opts?.processingMode||"CLONE_OFF"}get useStrictMode(){return this._opts?.useStrictMode}get scriptEnabled(){return this._opts?.scriptEnabled}get useGlobalContext(){return this._opts?.useGlobalContext}get hashFunction(){return this._opts?.hashFunction}get collectionResolver(){return this._opts?.collectionResolver}get jsonSchemaValidator(){return this._opts?.jsonSchemaValidator}get variables(){return this._opts?.variables}get context(){return this._opts?.context}};function Nt(e){return e instanceof V?e.getOptions():Object.freeze(G(U({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:"CLONE_OFF"},e),{context:e?.context?Mt.from(e?.context):Mt.init({})}))}var Se=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(Se||{}),Mt=class e{constructor(t){this.operators={accumulator:{},expression:{},pipeline:{},projection:{},query:{},window:{}};for(let[r,o]of Object.entries(t))this.addOperators(r,o)}static init(t={}){return new e(t)}static from(t){return new e(t.operators)}addOperators(t,r){for(let[o,n]of Object.entries(r))this.getOperator(t,o)||(this.operators[t][o]=n);return this}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}getOperator(t,r){return t in this.operators&&this.operators[t][r]||null}},mt=Mt.init();function Pn(e,t){for(let[r,o]of Object.entries(t)){g(co(o)&&Oe(r),`'${r}' is not a valid operator`);let n=Ee(e,r,null);g(!n||o===n,`${r} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":mt.addAccumulatorOps(t);break;case"expression":mt.addExpressionOps(t);break;case"pipeline":mt.addPipelineOps(t);break;case"projection":mt.addProjectionOps(t);break;case"query":mt.addQueryOps(t);break;case"window":mt.addWindowOps(t);break}}function Ee(e,t,r){let{context:o,useGlobalContext:n}=r||{},i=o?o.getOperator(e,t):null;return!i&&n?mt.getOperator(e,t):i}var fa={$$ROOT(e,t,r){return r.root},$$CURRENT(e,t,r){return e},$$REMOVE(e,t,r){},$$NOW(e,t,r){return new Date(r.timestamp)}},Mn={$$KEEP(e,t,r){return e},$$PRUNE(e,t,r){},$$DESCEND(e,t,r){if(!ae(t,"$cond"))return e;let o;for(let[n,i]of Object.entries(e))if(er(i)){if(i instanceof Array){let s=[];for(let a of i)C(a)&&(a=Nn(a,t,r.update(a))),v(a)||s.push(a);o=s}else o=Nn(i,t,r.update(i));v(o)?delete e[n]:e[n]=o}return e}};function p(e,t,r,o){let n=V.init(o,e);if(r=r||"",Oe(r)){let i=Ee("expression",r,o);if(i)return i(e,t,n);let s=Ee("accumulator",r,o);if(s)return e instanceof Array||(e=p(e,t,null,n),t=null),g(e instanceof Array,`'${r}' target must be an array.`),s(e,t,n.update(null,n.local));throw new X(`operator '${r}' is not registered`)}if(T(t)&&t.length>0&&t[0]==="$"){if(ae(Mn,t))return t;let i=n.root,s=t.split(".");if(ae(fa,s[0]))i=fa[s[0]](e,null,n),t=t.slice(s[0].length+1);else if(s[0].slice(0,2)==="$$"){i=Object.assign({},n.variables,{this:e},n.local?.variables);let a=s[0].slice(2);g(ae(i,a),`Use of undefined variable: ${a}`),t=t.slice(2)}else t=t.slice(1);return t===""?i:Fe(i,t)}if(O(t))return t.map(i=>p(e,i,null,n));if(C(t)){let i={};for(let[s,a]of Object.entries(t))if(i[s]=p(e,a,s,n),["expression","accumulator"].some(u=>!!Ee(u,s,o)))return g(Object.keys(t).length===1,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),i[s];return i}return t}function Nn(e,t,r){let o=p(e,t,null,r);return ae(Mn,o)?Mn[o](e,t,r):o}function pe(e){return e instanceof rr?e:new rr(e)}function go(...e){let t=0;return pe(()=>{for(;t<e.length;){let r=e[t].next();if(!r.done)return r;t++}return{done:!0}})}function sl(e){return!!e&&typeof e=="object"&&e?.next instanceof Function}function al(e,t){let r=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,r)}var kn=new Error;function ul(e,t,r){let o=!1,n=-1,i=0;return function(s){try{e:for(;!o;){let a=e();n++;let u=-1,l=t.length,c=!1;for(;++u<l;){let f=t[u];switch(f.action){case 0:a=f.func(a,n);break;case 1:if(!f.func(a,n))continue e;break;case 2:--f.count,f.count||(c=!0);break;case 3:--f.count,f.count||al(t,u);continue e;default:break e}}if(o=c,s)r[i++]=a;else return{value:a,done:!1}}}catch(a){if(a!==kn)throw a}return o=!0,{done:o}}}var rr=class{constructor(t){this.iteratees=[],this.yieldedValues=[],this.isDone=!1;let r;if(t instanceof Function&&(t={next:t}),sl(t)){let o=t;r=()=>{let n=o.next();if(n.done)throw kn;return n.value}}else if(t instanceof Array){let o=t,n=o.length,i=0;r=()=>{if(i<n)return o[i++];throw kn}}else if(!(t instanceof Function))throw new X("Lazy must be initialized with an array, generator, or function.");this.getNext=ul(r,this.iteratees,this.yieldedValues)}push(t,r){return typeof r=="function"?this.iteratees.push({action:t,func:r}):typeof r=="number"&&this.iteratees.push({action:t,count:r}),this}next(){return this.getNext()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){let r=this,o;return pe(()=>(o||(o=pe(t(r.value()))),o.next()))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(t){for(;;){let r=this.next();if(r.done)break;if(t(r.value)===!1)return!1}return!0}reduce(t,r){let o=this.next();for(r===void 0&&!o.done&&(r=o.value,o=this.next());!o.done;)r=t(r,o.value),o=this.next();return r}size(){return this.reduce((t,r)=>++t,0)}[Symbol.iterator](){return this}};var Te=class{constructor(t,r){this.pipeline=t,this.options=Nt(r)}stream(t){let r=pe(t),o=this.options.processingMode;(o==pt.CLONE_ALL||o==pt.CLONE_INPUT)&&r.map(fo);let n=new Array;if(!fe(this.pipeline))for(let i of this.pipeline){let s=Object.keys(i),a=s[0],u=Ee(Se.PIPELINE,a,this.options);g(s.length===1&&!!u,`invalid pipeline operator ${a}`),n.push(a),r=u(r,i[a],this.options)}return(o==pt.CLONE_OUTPUT||o==pt.CLONE_ALL&&ft([["$group","$unwind"],n]).length)&&r.map(fo),r}run(t){return this.stream(t).value()}};var vo=class{constructor(t,r,o,n){this.source=t,this.predicate=r,this.projection=o,this.options=n,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result?this.result:(C(this.projection)&&this.operators.push({$project:this.projection}),this.result=pe(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Te(this.operators,this.options).stream(this.result)),this.result)}fetchAll(){let t=pe([...this.buffer]);return this.buffer=[],go(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.operators.push({$skip:t}),this}limit(t){return this.operators.push({$limit:t}),this}sort(t){return this.operators.push({$sort:t}),this}collation(t){return this.options=G(U({},this.options),{collation:t}),this}next(){if(this.buffer.length>0)return this.buffer.pop();let t=this.fetch().next();if(!t.done)return t.value}hasNext(){if(this.buffer.length>0)return!0;let t=this.fetch().next();return t.done?!1:(this.buffer.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}};var he=class{constructor(t,r){this.condition=t,this.options=Nt(r),this.compiled=[],this.compile()}compile(){g(C(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);let t={};for(let[r,o]of Object.entries(this.condition)){if(r==="$where")Object.assign(t,{field:r,expr:o});else if(Re(["$and","$or","$nor","$expr","$jsonSchema"],r))this.processOperator(r,r,o);else{g(!Oe(r),`unknown top level operator: ${r}`);for(let[n,i]of Object.entries(yo(o)))this.processOperator(r,n,i)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,r,o){let n=Ee(Se.QUERY,r,this.options);if(!n)throw new X(`unknown query operator ${r}`);let i=n(t,o,this.options);this.compiled.push(i)}test(t){for(let r=0,o=this.compiled.length;r<o;r++)if(!this.compiled[r](t))return!1;return!0}find(t,r){return new vo(t,o=>this.test(o),r||{},this.options)}remove(t){return t.reduce((r,o)=>(this.test(o)||r.push(o),r),[])}};var Pt=1e3*60*60*24,pa={week:Pt*7,day:Pt,hour:1e3*60*60,minute:1e3*60,second:1e3,millisecond:1};var Lw={week:Pt*7,day:Pt,hour:Pt/24,minute:6e4,second:1e3,millisecond:1};var bo=(e,t,r)=>{if(fe(t)||!C(t))return e;let o=H,n=r.collation;return C(n)&&T(n.locale)&&(o=vl(n)),e.transform(i=>{let s=Object.keys(t);for(let a of s.reverse()){let u=po(i,c=>Fe(c,a),r.hashFunction),l=Array.from(u.keys()).sort(o);t[a]===-1&&l.reverse(),i=[],l.reduce((c,f)=>ve(c,u.get(f)),i)}return i})},gl={1:"base",2:"accent",3:"variant"};function vl(e){let t={sensitivity:gl[e.strength||3],caseFirst:e.caseFirst==="off"?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:e.alternate==="shifted"};(e.caseLevel||!1)===!0&&(t.sensitivity==="base"&&(t.sensitivity="case"),t.sensitivity==="accent"&&(t.sensitivity="variant"));let r=new Intl.Collator(e.locale,t);return(o,n)=>{if(!T(o)||!T(n))return H(o,n);let i=r.compare(o,n);return i<0?-1:i>0?1:0}}function N(e){let t=(r,o,n)=>{let i={unwrapArray:!0},s=Math.max(1,r.split(".").length-1);return a=>{let u=Fe(a,r,i);return e(u,o,G(U({},n),{depth:s}))}};return t.op="query",t}function ue(e){return(t,r,o)=>{let n=p(t,r,null,o);return e(...n)}}function or(e,t,r){if(me(e,t)||v(e)&&v(t))return!0;if(e instanceof Array){let o=me.bind(null,t);return e.some(o)||Dn(e,r?.depth).some(o)}return!1}function _o(e,t,r){return!or(e,t,r)}function Ln(e,t,r){return v(e)?t.some(o=>o===null):ft([ke(e),t],r?.hashFunction).length>0}function wo(e,t,r){return!Ln(e,t,r)}function Oo(e,t,r){return Ao(e,t,(o,n)=>H(o,n)<0)}function Eo(e,t,r){return Ao(e,t,(o,n)=>H(o,n)<=0)}function So(e,t,r){return Ao(e,t,(o,n)=>H(o,n)>0)}function $o(e,t,r){return Ao(e,t,(o,n)=>H(o,n)>=0)}function xa(e,t,r){return ke(e).some(o=>t.length===2&&o%t[0]===t[1])}function ba(e,t,r){let o=ke(e),n=i=>T(i)&&Ce(t.exec(i),r?.useStrictMode);return o.some(n)||Dn(o,1).some(n)}function _a(e,t,r){return(t===!1||t===0)&&e===void 0||(t===!0||t===1)&&e!==void 0}function wa(e,t,r){if(!O(e)||!O(t)||!e.length||!t.length)return!1;let o=!0;for(let n of t){if(!o)break;C(n)&&Re(Object.keys(n),"$elemMatch")?o=Bn(e,n.$elemMatch,r):n instanceof RegExp?o=e.some(i=>typeof i=="string"&&n.test(i)):o=e.some(i=>me(n,i))}return o}function Oa(e,t,r){return Array.isArray(e)&&e.length===t}function wl(e){return Oe(e)&&["$and","$or","$nor"].indexOf(e)===-1}function Bn(e,t,r){if(O(e)&&!fe(e)){let o=s=>s,n=t;Object.keys(t).every(wl)&&(n={temp:t},o=s=>({temp:s}));let i=new he(n,r);for(let s=0,a=e.length;s<a;s++)if(i.test(o(e[s])))return!0}return!1}var da=e=>e===null,ya=e=>I(e)&&e>=ao&&e<=so&&e.toString().indexOf(".")===-1,ga=e=>I(e)&&e>=Cn&&e<=Rn&&e.toString().indexOf(".")===-1,Ol={array:O,bool:Zt,boolean:Zt,date:Tt,decimal:I,double:I,int:ya,long:ga,number:I,null:da,object:C,regex:Dt,regexp:Dt,string:T,undefined:v,function:e=>{throw new X("unsupported type key `function`.")},1:I,2:T,3:C,4:O,6:v,8:Zt,9:Tt,10:da,11:Dt,16:ya,18:ga,19:I};function va(e,t,r){let o=Ol[t];return o?o(e):!1}function Ea(e,t,r){return Array.isArray(t)?t.findIndex(o=>va(e,o,r))>=0:va(e,t,r)}function Ao(e,t,r){return ke(e).some(o=>He(o)===He(t)&&r(o,t))}var YS=ue(wo);var kt=(e,t)=>(r,o,n)=>{g(O(o),`${e}: expression must be an array.`);let i=p(r,o,null,n);return i.some(v)?null:(g(i.every(I),`${e}: expression must evalue to array of numbers.`),t(i))};var z1=kt("$bitAnd",e=>e.reduce((t,r)=>t&r,-1));var J1=kt("$bitOr",e=>e.reduce((t,r)=>t|r,0));var e$=kt("$bitXor",e=>e.reduce((t,r)=>t^r,0));var O$=ue(or);var $$=ue(So);var R$=ue($o);var D$=ue(Oo);var P$=ue(Eo);var L$=ue(_o);var Sa=(e,t)=>{let r={};return e.split("").forEach((o,n)=>r[o]=t*(n+1)),r},xA=G(U(U({},Sa("ABCDEFGHIKLM",1)),Sa("NOPQRSTUVWXY",-1)),{Z:0});var Ra={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function L(e,t=Ra){let r=Object.assign({},Ra,t),o=new Set(Object.keys(r));return(n,i,s)=>{let a=p(n,i,null,s);if(o.has(`${a}`)){let u=r[`${a}`];if(u instanceof Error)throw new X(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return u}return e(a)}}var AT=L(Math.acos,{Infinity:1/0,0:new Error});var CT=L(Math.acosh,{Infinity:1/0,0:new Error});var MT=L(Math.asin);var kT=L(Math.asinh,{Infinity:1/0,"-Infinity":-1/0});var BT=L(Math.atan);var zT=L(Math.atanh,{1:1/0,"-1":-1/0});var QT=L(Math.cos);var JT=L(Math.cosh,{"-Infinity":1/0,Infinity:1/0});var Al=Math.PI/180,eD=L(e=>e*Al,{Infinity:1/0,"-Infinity":1/0});var Il=180/Math.PI,oD=L(e=>e*Il,{Infinity:1/0,"-Infinity":-1/0});var sD=L(Math.sin);var cD=L(Math.sinh,{"-Infinity":-1/0,Infinity:1/0});var mD=L(Math.tan);var jn=(e,t,r)=>{if(fe(t))return e;let o=Object.keys(t),n=!1;Ta(t,r);let i=r.idKey;if(Re(o,i)){let a=t[i];(a===0||a===!1)&&(o=o.filter(lo.bind(null,[i])),n=o.length==0)}else o.push(i);let s=V.init(r);return e.map(a=>Un(a,t,s.update(a),o,n))};function Un(e,t,r,o,n){let i={},s=!1,a=!1,u=[];n&&u.push(r.idKey);for(let l of o){let c,f=t[l];if(l!==r.idKey&&Re([0,!1],f)&&(a=!0),l===r.idKey&&fe(f))c=e[l];else if(T(f))c=p(e,f,l,r);else if(!Re([1,!0],f))if(f instanceof Array)c=f.map(m=>{let d=p(e,m,null,r);return v(d)?null:d});else if(C(f)){let m=f,d=Object.keys(f),y=d.length==1?d[0]:"",b=Ee(Se.PROJECTION,y,r);if(b)y==="$slice"?ke(m[y]).every(I)?(c=b(e,m[y],l,r),s=!0):c=p(e,m,l,r):c=b(e,m[y],l,r);else if(Oe(y))c=p(e,m[y],y,r);else if(ae(e,l)){Ta(m,r);let x=e[l];x instanceof Array?c=x.map(w=>Un(w,m,r,d,!1)):(x=C(x)?x:e,c=Un(x,m,r,d,!1))}else c=p(e,f,null,r)}else{u.push(l);continue}let h=Ct(e,l,{preserveMissing:!0});h!==void 0&&oo(i,h,{flatten:!0}),lo([0,1,!1,!0],f)&&(c===void 0?tr(i,l,{descendArray:!0}):ho(i,l,c))}if(no(i),(s||a||n)&&(i=ve({},e,i),u.length>0))for(let l of u)tr(i,l,{descendArray:!0});return i}function Ta(e,t){let r=[!1,!1];for(let[o,n]of Object.entries(e)){if(o===t?.idKey)return;n===0||n===!1?r[0]=!0:(n===1||n===!0)&&(r[1]=!0),g(!(r[0]&&r[1]),"Projection cannot have a mix of inclusion and exclusion.")}}var Da=(e,t,r)=>{g(O(t),"Invalid expression: $and expects value to be an Array.");let o=t.map(n=>new he(n,r));return n=>o.every(i=>i.test(n))};var Io=(e,t,r)=>{g(O(t),"Invalid expression. $or expects value to be an Array");let o=t.map(n=>new he(n,r));return n=>o.some(i=>i.test(n))};var Ma=(e,t,r)=>{g(O(t),"Invalid expression. $nor expects value to be an array.");let o=Io("$or",t,r);return n=>!o(n)};var Na=(e,t,r)=>{let o={};o[e]=yo(t);let n=new he(o,r);return i=>!n.test(i)};var Vn=N(or);var Wn=N(So);var qn=N($o);var zn=N(Ln);var Hn=N(Oo);var Kn=N(Eo);var Qn=N(_o);var Yn=N(wo);var Pa=N(xa);var ka=N(ba);var yk=N(wa);var Fa=N(Bn);var La=N(Oa);var Ba=N(_a);var Ua=N(Ea);var ja=!1;function Va(e){return ja||(Pn(Se.PIPELINE,{$sort:bo,$project:jn}),Pn(Se.QUERY,{$and:Da,$eq:Vn,$elemMatch:Fa,$exists:Ba,$gt:Wn,$gte:qn,$in:zn,$lt:Hn,$lte:Kn,$ne:Qn,$nin:Yn,$mod:Pa,$nor:Ma,$not:Na,$or:Io,$regex:ka,$size:La,$type:Ua}),ja=!0),new he(e)}function nr(e,t){var r=qe(e.primaryKey);t=q(t);var o=$e(t);if(typeof o.skip!="number"&&(o.skip=0),o.selector?(o.selector=o.selector,Object.entries(o.selector).forEach(([l,c])=>{(typeof c!="object"||c===null)&&(o.selector[l]={$eq:c})})):o.selector={},o.index){var n=Zi(o.index);n.includes(r)||n.push(r),o.index=n}if(o.sort){var u=o.sort.find(l=>mi(l)===r);u||(o.sort=o.sort.slice(0),o.sort.push({[r]:"asc"}))}else if(o.index)o.sort=o.index.map(l=>({[l]:"asc"}));else{if(e.indexes){var i=new Set;Object.entries(o.selector).forEach(([l,c])=>{var f=!1;typeof c=="object"&&c!==null?f=!!Object.keys(c).find(h=>to.has(h)):f=!0,f&&i.add(l)});var s=-1,a;e.indexes.forEach(l=>{var c=Ot(l)?l:[l],f=c.findIndex(h=>!i.has(h));f>0&&f>s&&(s=f,a=c)}),a&&(o.sort=a.map(l=>({[l]:"asc"})))}o.sort||(o.sort=[{[r]:"asc"}])}return o}function Wa(e,t){if(!t.sort)throw _("SNH",{query:t});var r=[];t.sort.forEach(n=>{var i=Object.keys(n)[0],s=Object.values(n)[0];r.push({key:i,direction:s,getValueFn:fi(i)})});var o=(n,i)=>{for(var s=0;s<r.length;++s){var a=r[s],u=a.getValueFn(n),l=a.getValueFn(i);if(u!==l){var c=a.direction==="asc"?H(u,l):H(l,u);return c}}};return o}function Ro(e,t){if(!t.sort)throw _("SNH",{query:t});var r=Va(t.selector),o=n=>r.test(n);return o}async function Ft(e,t){var r=await e.exec();if(!r)return null;if(Array.isArray(r))return Promise.all(r.map(n=>t(n)));if(r instanceof Map)return Promise.all([...r.values()].map(n=>t(n)));var o=await t(r);return o}function Tl(e,t){return!t.sort||t.sort.length===0?[e]:t.sort.map(r=>Object.keys(r)[0])}var Dl=new WeakMap;function Ml(e){return we(Dl,e,()=>{var t=e.collection,r=nr(t.storageInstance.schema,$e(e.mangoQuery)),o=t.schema.primaryPath,n=Wa(t.schema.jsonSchema,r),i=(l,c)=>{var f={docA:l,docB:c,rxQuery:e};return n(f.docA,f.docB)},s=Ro(t.schema.jsonSchema,r),a=l=>{var c={doc:l,rxQuery:e};return s(c.doc)},u={primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:Tl(o,r),sortComparator:i,queryMatcher:a};return u})}function qa(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=Ml(e),o=k(e._result).docsData.slice(0),n=k(e._result).docsDataMap,i=!1,s=t.map(u=>oa(u)).filter(es),a=s.find(u=>{var l={queryParams:r,changeEvent:u,previousResults:o,keyDocumentMap:n},c=ea(l);if(c==="runFullQueryAgain")return!0;if(c!=="doNothing")return i=!0,ta(c,r,u,o,n),!1});return a?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:i,newResults:o}}var Nl=function(){function e(){this._map=new Map}var t=e.prototype;return t.getByQuery=function(o){var n=o.toString();return we(this._map,n,()=>o)},e}();function Ha(){return new Nl}function za(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function Pl(e){return e.refCount$.observers.length}var kl=100,Fl=30*1e3,Ll=(e,t)=>(r,o)=>{if(!(o._map.size<e)){var n=re()-t,i=[],s=Array.from(o._map.values());for(var a of s)if(!(Pl(a)>0)){if(a._lastEnsureEqual===0&&a._creationTime<n){za(o,a);continue}i.push(a)}var u=i.length-e;if(!(u<=0)){var l=i.sort((f,h)=>f._lastEnsureEqual-h._lastEnsureEqual),c=l.slice(0,u);c.forEach(f=>za(o,f))}}},Jn=Ll(kl,Fl),Gn=new WeakSet;function Ka(e){Gn.has(e)||(Gn.add(e),cs().then(()=>ms(200)).then(()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),Gn.delete(e)}))}var Ya=function(){function e(r,o,n){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry=typeof FinalizationRegistry=="function"?new FinalizationRegistry(i=>{var s=i.docId,a=this.cacheItemByDocId.get(s);a&&(a[0].delete(i.revisionHeight),a[0].size===0&&this.cacheItemByDocId.delete(s))}):void 0,this.primaryPath=r,this.changes$=o,this.documentCreator=n,o.subscribe(i=>{this.tasks.add(()=>{for(var s=this.cacheItemByDocId,a=0;a<i.length;a++){var u=i[a],l=s.get(u.documentId);if(l){var c=u.documentData;c||(c=u.previousDocumentData),l[1]=c}}}),this.tasks.size<=1&&Rt().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var o=Array.from(this.tasks);o.forEach(n=>n()),this.tasks.clear()}},t.getLatestDocumentData=function(o){this.processTasks();var n=We(this.cacheItemByDocId,o);return n[1]},t.getLatestDocumentDataIfExists=function(o){this.processTasks();var n=this.cacheItemByDocId.get(o);if(n)return n[1]},ee(e,[{key:"getCachedRxDocuments",get:function(){var r=Qa(this);return le(this,"getCachedRxDocuments",r)}},{key:"getCachedRxDocument",get:function(){var r=Qa(this);return le(this,"getCachedRxDocument",o=>r([o])[0])}}])}();function Qa(e){var t=e.primaryPath,r=e.cacheItemByDocId,o=e.registry,n=F.deepFreezeWhenDevMode,i=e.documentCreator,s=a=>{for(var u=new Array(a.length),l=[],c=0;c<a.length;c++){var f=a[c],h=f[t],m=ut(f._rev),d=void 0,y=void 0,b=r.get(h);b?(d=b[0],y=d.get(m)):(d=new Map,b=[d,f],r.set(h,b));var x=y?y.deref():void 0;x||(f=n(f),x=i(f),d.set(m,Ul(x)),o&&l.push(x)),u[c]=x}return l.length>0&&o&&(e.tasks.add(()=>{for(var w=0;w<l.length;w++){var S=l[w];o.register(S,{docId:S.primary,revisionHeight:ut(S.revision)})}}),e.tasks.size<=1&&Rt().then(()=>{e.processTasks()})),u};return s}function Co(e,t){var r=e.getCachedRxDocuments;return r(t)}var Bl=typeof WeakRef=="function",Ul=Bl?jl:Vl;function jl(e){return new WeakRef(e)}function Vl(e){return{deref(){return e}}}var Xn=function(){function e(r,o,n){this.time=re(),this.query=r,this.count=n,this.documents=Co(this.query.collection._docCache,o)}var t=e.prototype;return t.getValue=function(o){var n=this.query.op;if(n==="count")return this.count;if(n==="findOne"){var i=this.documents.length===0?null:this.documents[0];if(!i&&o)throw _("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:n});return i}else return n==="findByIds"?this.docsMap:this.documents.slice(0)},ee(e,[{key:"docsData",get:function(){return le(this,"docsData",this.documents.map(r=>r._data))}},{key:"docsDataMap",get:function(){var r=new Map;return this.documents.forEach(o=>{r.set(o.primary,o._data)}),le(this,"docsDataMap",r)}},{key:"docsMap",get:function(){for(var r=new Map,o=this.documents,n=0;n<o.length;n++){var i=o[n];r.set(i.primary,i)}return le(this,"docsMap",r)}}])}();var Wl=0,ql=function(){return++Wl},zl=function(){function e(r,o,n,i={}){this.id=ql(),this._execOverDatabaseCount=0,this._creationTime=re(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new Wt(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=Ie,this.op=r,this.mangoQuery=o,this.collection=n,this.other=i,o||(this.mangoQuery=ir()),this.isFindOneByIdQuery=Yl(this.collection.schema.primaryPath,o)}var t=e.prototype;return t._setResultData=function(o){if(typeof o>"u")throw _("QU18",{database:this.collection.database.name,collection:this.collection.name});if(typeof o=="number"){this._result=new Xn(this,[],o);return}else o instanceof Map&&(o=Array.from(o.values()));var n=new Xn(this,o,o.length);this._result=n},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=re(),this.op==="count"){var o=this.getPreparedQuery(),n=await this.collection.storageInstance.count(o);if(n.mode==="slow"&&!this.collection.database.allowSlowCount)throw _("QU14",{collection:this.collection,queryObj:this.mangoQuery});return n.count}if(this.op==="findByIds"){var i=k(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,s=new Map,a=[];if(i.forEach(c=>{var f=this.collection._docCache.getLatestDocumentDataIfExists(c);if(f){if(!f._deleted){var h=this.collection._docCache.getCachedRxDocument(f);s.set(c,h)}}else a.push(c)}),a.length>0){var u=await this.collection.storageInstance.findDocumentsById(a,!1);u.forEach(c=>{var f=this.collection._docCache.getCachedRxDocument(c);s.set(f.primary,f)})}return s}var l=Ql(this);return l.then(c=>(this._lastExecEnd=re(),c))},t.exec=async function(o){if(o&&this.op!=="findOne")throw _("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});await Ga(this);var n=k(this._result);return n.getValue(o)},t.toString=function(){var o=ht({op:this.op,query:this.mangoQuery,other:this.other},!0),n=JSON.stringify(o);return this.toString=()=>n,n},t.getPreparedQuery=function(){var o={rxQuery:this,mangoQuery:nr(this.collection.schema.jsonSchema,this.mangoQuery)};o.mangoQuery.selector._deleted={$eq:!1},o.mangoQuery.index&&o.mangoQuery.index.unshift("_deleted"),Q("prePrepareQuery",o);var n=Zn(this.collection.schema.jsonSchema,o.mangoQuery);return this.getPreparedQuery=()=>n,n},t.doesDocumentDataMatch=function(o){return o._deleted?!1:this.queryMatcher(o)},t.remove=function(){return this.exec().then(o=>Array.isArray(o)?Promise.all(o.map(n=>n.remove())):o.remove())},t.incrementalRemove=function(){return Ft(this.asRxQuery,o=>o.incrementalRemove())},t.update=function(o){throw D("update")},t.patch=function(o){return Ft(this.asRxQuery,n=>n.patch(o))},t.incrementalPatch=function(o){return Ft(this.asRxQuery,n=>n.incrementalPatch(o))},t.modify=function(o){return Ft(this.asRxQuery,n=>n.modify(o))},t.incrementalModify=function(o){return Ft(this.asRxQuery,n=>n.incrementalModify(o))},t.where=function(o){throw D("query-builder")},t.sort=function(o){throw D("query-builder")},t.skip=function(o){throw D("query-builder")},t.limit=function(o){throw D("query-builder")},ee(e,[{key:"$",get:function(){if(!this._$){var r=this.collection.$.pipe(j(o=>!o.isLocal),Yt(null),se(()=>Ga(this)),J(()=>this._result),xt(Kr),tt((o,n)=>!!(o&&o.time===k(n).time)),j(o=>!!o),J(o=>k(o).getValue()));this._$=an(r,this.refCount$.pipe(j(()=>!1)))}return this._$}},{key:"$$",get:function(){var r=this.collection.database.getReactivityFactory();return r.fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){var r=this.collection.schema.jsonSchema,o=nr(this.collection.schema.jsonSchema,this.mangoQuery);return le(this,"queryMatcher",Ro(r,o))}},{key:"asRxQuery",get:function(){return this}}])}();function ir(){return{selector:{}}}function Hl(e){return e.collection._queryCache.getByQuery(e)}function Lt(e,t,r,o){Q("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:o});var n=new zl(e,t,r,o);return n=Hl(n),Ka(r),n}function Ja(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}async function Ga(e){return e.collection.awaitBeforeReads.size>0&&await Promise.all(Array.from(e.collection.awaitBeforeReads).map(t=>t())),e.collection.database.destroyed||Ja(e)?!1:(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>Kl(e)),e._ensureEqualQueue)}function Kl(e){if(e._lastEnsureEqual=re(),e.collection.database.destroyed||Ja(e))return Ie;var t=!1,r=!1;if(e._latestChangeEvent===-1&&(r=!0),!r){var o=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(o===null)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var n=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(o);if(e.op==="count"){var i=k(e._result).count,s=i;n.forEach(u=>{var l=u.previousDocumentData&&e.doesDocumentDataMatch(u.previousDocumentData),c=e.doesDocumentDataMatch(u.documentData);!l&&c&&s++,l&&!c&&s--}),s!==i&&(t=!0,e._setResultData(s))}else{var a=qa(e,n);a.runFullQueryAgain?r=!0:a.changed&&(t=!0,e._setResultData(a.newResults))}}}return r?e._execOverDatabase().then(u=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),typeof u=="number"?((!e._result||u!==e._result.count)&&(t=!0,e._setResultData(u)),t):((!e._result||!us(e.collection.schema.primaryPath,u,e._result.docsData))&&(t=!0,e._setResultData(u)),t))):Promise.resolve(t)}function Zn(e,t){if(!t.sort)throw _("SNH",{query:t});var r=na(e,t);return{query:t,queryPlan:r}}async function Ql(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var o=e.isFindOneByIdQuery;if(o=o.filter(c=>{var f=e.collection._docCache.getLatestDocumentDataIfExists(c);return f?(f._deleted||t.push(f),!1):!0}),o.length>0){var n=await r.storageInstance.findDocumentsById(o,!1);Ne(t,n)}}else{var i=e.isFindOneByIdQuery,s=e.collection._docCache.getLatestDocumentDataIfExists(i);if(!s){var a=await r.storageInstance.findDocumentsById([i],!1);a[0]&&(s=a[0])}s&&!s._deleted&&t.push(s)}else{var u=e.getPreparedQuery(),l=await r.storageInstance.query(u);t=l.documents}return t}function Yl(e,t){if(!t.skip&&t.selector&&Object.keys(t.selector).length===1&&t.selector[e]){var r=t.selector[e];if(typeof r=="string")return r;if(Object.keys(r).length===1&&typeof r.$eq=="string"||Object.keys(r).length===1&&Array.isArray(r.$eq)&&!r.$eq.find(o=>typeof o!="string"))return r.$eq}return!1}var Xa="_rxdb_internal";async function ti(e,t){var r=await e.findDocumentsById([t],!1),o=r[0];if(o)return o}function Bt(e,t,r,o){if(o)throw o.status===409?_("CONFLICT",{collection:e.name,id:t,writeError:o,data:r}):o.status===422?_("VD2",{collection:e.name,id:t,writeError:o,data:r}):o}function RF(e,t,r,o,n,i,s){for(var a=!!e.schema.attachments,u=[],l=[],c=[],f=st(10),h={id:f,events:[],checkpoint:null,context:n,startTime:re(),endTime:0},m=h.events,d=[],y=[],b=[],x=r.size>0,w,S=o.length,Z=function(){var z=o[M],P=z.document,W=z.previous,ne=P[t],Ke=P._deleted,Lo=W&&W._deleted,jt=void 0;x&&(jt=r.get(ne));var Qe;if(jt){var xu=jt._rev;if(!W||W&&xu!==W._rev){var bu={isError:!0,status:409,documentId:ne,writeRow:z,documentInDb:jt};return c.push(bu),1}var ur=a?ei(z):z;a&&(Ke?W&&Object.keys(W._attachments).forEach(ce=>{y.push({documentId:ne,attachmentId:ce,digest:k(W)._attachments[ce].digest})}):(Object.entries(P._attachments).find(([ce,be])=>{var fr=W?W._attachments[ce]:void 0;return!fr&&!be.data&&(Qe={documentId:ne,documentInDb:jt,isError:!0,status:510,writeRow:z,attachmentId:ce}),!0}),Qe||Object.entries(P._attachments).forEach(([ce,be])=>{var fr=W?W._attachments[ce]:void 0;if(!fr)d.push({documentId:ne,attachmentId:ce,attachmentData:be,digest:be.digest});else{var wu=ur.document._attachments[ce].digest;be.data&&fr.digest!==wu&&b.push({documentId:ne,attachmentId:ce,attachmentData:be,digest:be.digest})}}))),Qe?c.push(Qe):(a?(l.push(ei(ur)),s&&s(P)):(l.push(ur),s&&s(P)),w=ur);var cr=null,Bo=null,lr=null;if(Lo&&!Ke)lr="INSERT",cr=a?De(P):P;else if(W&&!Lo&&!Ke)lr="UPDATE",cr=a?De(P):P,Bo=W;else if(Ke)lr="DELETE",cr=k(P),Bo=W;else throw _("SNH",{args:{writeRow:z}});var _u={documentId:ne,documentData:cr,previousDocumentData:Bo,operation:lr};m.push(_u)}else{var gu=!!Ke;if(a&&Object.entries(P._attachments).forEach(([ce,be])=>{be.data?d.push({documentId:ne,attachmentId:ce,attachmentData:be,digest:be.digest}):(Qe={documentId:ne,isError:!0,status:510,writeRow:z,attachmentId:ce},c.push(Qe))}),Qe||(a?(u.push(ei(z)),i&&i(P)):(u.push(z),i&&i(P)),w=z),!gu){var vu={documentId:ne,operation:"INSERT",documentData:a?De(P):P,previousDocumentData:a&&W?De(W):W};m.push(vu)}}},M=0;M<S;M++)Z();return{bulkInsertDocs:u,bulkUpdateDocs:l,newestRow:w,errors:c,eventBulk:h,attachmentsAdd:d,attachmentsRemove:y,attachmentsUpdate:b}}function ei(e){return{previous:e.previous,document:De(e.document)}}function Gl(e){return atob(e).length}function Jl(e){var t=e.data;if(!t)return e;var r={length:Gl(t),digest:e.digest,type:e.type};return r}function De(e){if(!e._attachments||Object.keys(e._attachments).length===0)return e;var t=q(e);return t._attachments={},Object.entries(e._attachments).forEach(([r,o])=>{t._attachments[r]=Jl(o)}),t}function sr(e){return Object.assign({},e,{_meta:q(e._meta)})}var Za=new WeakMap;function To(e,t,r){F.deepFreezeWhenDevMode(r);var o=qe(t.schema.primaryKey),n={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,bulkWrite(i,s){for(var a=e.token,u=new Array(i.length),l=re(),c=0;c<i.length;c++){var f=i[c],h=sr(f.document);h._meta.lwt=l;var m=f.previous;h._rev=At(a,m),u[c]={document:h,previous:m}}return Q("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:u}),e.lockedRun(()=>t.bulkWrite(u,s)).then(d=>{var y={error:[]},b=xe(o,u,d);Za.set(y,b);var x=d.error.length===0?[]:d.error.filter(S=>S.status===409&&!S.writeRow.previous&&!S.writeRow.document._deleted&&k(S.documentInDb)._deleted?!0:(y.error.push(S),!1));if(x.length>0){var w=x.map(S=>({previous:S.documentInDb,document:Object.assign({},S.writeRow.document,{_rev:At(e.token,S.documentInDb)})}));return e.lockedRun(()=>t.bulkWrite(w,s)).then(S=>{Ne(y.error,S.error);var Z=xe(o,w,S);return Ne(b,Z),y})}return y})},query(i){return e.lockedRun(()=>t.query(i))},count(i){return e.lockedRun(()=>t.count(i))},findDocumentsById(i,s){return e.lockedRun(()=>t.findDocumentsById(i,s))},getAttachmentData(i,s,a){return e.lockedRun(()=>t.getAttachmentData(i,s,a))},getChangedDocumentsSince:t.getChangedDocumentsSince?(i,s)=>e.lockedRun(()=>t.getChangedDocumentsSince(k(i),s)):void 0,cleanup(i){return e.lockedRun(()=>t.cleanup(i))},remove(){return e.storageInstances.delete(n),e.lockedRun(()=>t.remove())},close(){return e.storageInstances.delete(n),e.lockedRun(()=>t.close())},changeStream(){return t.changeStream()},conflictResultionTasks(){return t.conflictResultionTasks()},resolveConflictResultionTask(i){if(i.output.isEqual)return t.resolveConflictResultionTask(i);var s=Object.assign({},i.output.documentData,{_meta:Ve(),_rev:Pe(),_attachments:{}}),a=q(s);return delete a._meta,delete a._rev,delete a._attachments,t.resolveConflictResultionTask({id:i.id,output:{isEqual:!1,documentData:a}})}};return e.storageInstances.add(n),n}function CF(e){if(e.schema.keyCompression)throw _("UT5",{args:{params:e}});if(Xl(e.schema))throw _("UT6",{args:{params:e}});if(e.schema.attachments&&e.schema.attachments.compression)throw _("UT7",{args:{params:e}})}function Xl(e){return!!(e.encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)}function xe(e,t,r){var o=Za.get(r);if(o)return o;var n=[];if(r.error.length>0){for(var i=new Set,s=0;s<r.error.length;s++){var a=r.error[s];i.add(a.documentId)}for(var u=0;u<t.length;u++){var l=t[u].document;i.has(l[e])||n.push(De(l))}}else{n.length=t.length-r.error.length;for(var c=0;c<t.length;c++){var f=t[c].document;n[c]=De(f)}}return n}var eu=function(){function e(r,o,n,i){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=r,this.primaryPath=o,this.preWrite=n,this.postWrite=i}var t=e.prototype;return t.addWrite=function(o,n){var i=o[this.primaryPath],s=we(this.queueByDocId,i,()=>[]),a=new Promise((u,l)=>{var c={lastKnownDocumentState:o,modifier:n,resolve:u,reject:l};k(s).push(c),this.triggerRun()});return a},t.triggerRun=async function(){if(!(this.isRunning===!0||this.queueByDocId.size===0)){this.isRunning=!0;var o=[],n=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(n.entries()).map(async([s,a])=>{var u=Zl(a.map(f=>f.lastKnownDocumentState)),l=u;for(var c of a)try{l=await c.modifier($e(l))}catch(f){c.reject(f),c.reject=()=>{},c.resolve=()=>{}}try{await this.preWrite(l,u)}catch(f){a.forEach(h=>h.reject(f));return}o.push({previous:u,document:l})}));var i=o.length>0?await this.storageInstance.bulkWrite(o,"incremental-write"):{error:[]};return await Promise.all(xe(this.primaryPath,o,i).map(s=>{var a=s[this.primaryPath];this.postWrite(s);var u=We(n,a);u.forEach(l=>l.resolve(s))})),i.error.forEach(s=>{var a=s.documentId,u=We(n,a),l=hr(s);if(l){var c=we(this.queueByDocId,a,()=>[]);u.reverse().forEach(h=>{h.lastKnownDocumentState=k(l.documentInDb),k(c).unshift(h)})}else{var f=bi(s);u.forEach(h=>h.reject(f))}}),this.isRunning=!1,this.triggerRun()}},e}();function ri(e){var t=async r=>{var o=as(r);o._deleted=r._deleted;var n=await e(o),i=Object.assign({},n,{_meta:r._meta,_attachments:r._attachments,_rev:r._rev,_deleted:typeof n._deleted<"u"?n._deleted:r._deleted});return typeof i._deleted>"u"&&(i._deleted=!1),i};return t}function Zl(e){var t=e[0],r=ut(t._rev);return e.forEach(o=>{var n=ut(o._rev);n>r&&(t=o,r=n)}),t}var oi={get primaryPath(){var e=this;if(e.isInstanceOfRxDocument)return e.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){var e=this;if(e.isInstanceOfRxDocument)return e._data._rev},get deleted$(){var e=this;if(e.isInstanceOfRxDocument)return e.$.pipe(J(t=>t._data._deleted))},get deleted$$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){var e=this;if(e.isInstanceOfRxDocument)return e._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this;return e.collection.$.pipe(j(t=>!t.isLocal),j(t=>t.documentId===this.primary),J(t=>ra(t)),Yt(e.collection._docCache.getLatestDocumentData(this.primary)),tt((t,r)=>t._rev===r._rev),J(t=>this.collection._docCache.getCachedRxDocument(t)),xt(Kr))},get $$(){var e=this,t=e.collection.database.getReactivityFactory();return t.fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(F.isDevMode()){if(e.includes(".item."))throw _("DOC1",{path:e});if(e===this.primaryPath)throw _("DOC2");if(this.collection.schema.finalFields.includes(e))throw _("DOC3",{path:e});var t=ct(this.collection.schema.jsonSchema,e);if(!t)throw _("DOC4",{path:e})}return this.$.pipe(J(r=>$t(r,e)),tt())},get$$(e){var t=this.get$(e),r=this.collection.database.getReactivityFactory();return r.fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=ct(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return fs;if(!t)throw _("DOC5",{path:e});if(!t.ref)throw _("DOC6",{path:e,schemaObj:t});var o=this.collection.database.collections[t.ref];if(!o)throw _("DOC7",{ref:t.ref,path:e,schemaObj:t});return t.type==="array"?o.findByIds(r).exec().then(n=>{var i=n.values();return Array.from(i)}):o.findOne(r).exec()},get(e){return ou(this,e)},toJSON(e=!1){if(e)return F.deepFreezeWhenDevMode(this._data);var t=q(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,F.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return $e(this.toJSON(e))},update(e){throw D("update")},incrementalUpdate(e){throw D("update")},updateCRDT(e){throw D("crdt")},putAttachment(){throw D("attachments")},getAttachment(){throw D("attachments")},allAttachments(){throw D("attachments")},get allAttachments$(){throw D("attachments")},async modify(e,t){var r=this._data,o=await ri(e)(r);return this._saveData(o,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,ri(e)).then(r=>this.collection._docCache.getCachedRxDocument(r))},patch(e){var t=this._data,r=$e(t);return Object.entries(e).forEach(([o,n])=>{r[o]=n}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([r,o])=>{t[r]=o}),t))},async _saveData(e,t){if(e=q(e),this._data._deleted)throw _("DOC11",{id:this.primary,document:this});await ni(this.collection,e,t);var r=[{previous:t,document:e}],o=await this.collection.storageInstance.bulkWrite(r,"rx-document-save-data"),n=o.error[0];return Bt(this.collection,this.primary,e,n),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(xe(this.collection.schema.primaryPath,r,o)[0])},remove(){var e=this.collection;if(this.deleted)return Promise.reject(_("DOC13",{document:this,id:this.primary}));var t=q(this._data),r;return e._runHooks("pre","remove",t,this).then(async()=>{t._deleted=!0;var o=[{previous:this._data,document:t}],n=await e.storageInstance.bulkWrite(o,"rx-document-remove"),i=n.error[0];return Bt(e,this.primary,t,i),xe(this.collection.schema.primaryPath,o,n)[0]}).then(o=>(r=o,this.collection._runHooks("post","remove",t,this))).then(()=>this.collection._docCache.getCachedRxDocument(r))},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},destroy(){throw _("DOC14")}};function tu(e=oi){var t=function(o,n){this.collection=o,this._data=n,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function ru(e,t,r){var o=new e(t,r);return Q("createRxDocument",o),o}function ni(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),F.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}function ou(e,t){return we(e._propertyCache,t,()=>{var r=$t(e._data,t);if(typeof r!="object"||r===null||Array.isArray(r))return F.deepFreezeWhenDevMode(r);var o=new Proxy(q(r),{get(n,i){if(typeof i!="string")return n[i];var s=i.charAt(i.length-1);if(s==="$")if(i.endsWith("$$")){var a=i.slice(0,-2);return e.get$$(at(t+"."+a))}else{var u=i.slice(0,-1);return e.get$(at(t+"."+u))}else if(s==="_"){var l=i.slice(0,-1);return e.populate(at(t+"."+l))}else{var c=n[i];return typeof c=="number"||typeof c=="string"||typeof c=="boolean"?c:ou(e,at(t+"."+i))}}});return o})}var Ut="collection",ii="storage-token",ef="rx-migration-status",tf="RxInternalDocument",Do=Qr({version:0,title:tf,primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[Ut,ii,ef,"OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Mo(e,t){return Gt(Do,{key:e,context:t})}async function No(e){var t=Zn(e.schema,{selector:{context:Ut,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0}),r=await e.query(t),o=r.documents;return o}var nu="storageToken",rf=Mo(nu,ii);async function iu(e){var t=st(10),r=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,o={id:rf,context:ii,key:nu,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:Ve(),_rev:Pe(),_attachments:{}},n=[{document:o}],i=await e.internalStore.bulkWrite(n,"internal-add-storage-token");if(!i.error[0])return xe("id",n,i)[0];var s=k(i.error[0]);if(s.isError&&hr(s)){var a=s;if(!of(a.documentInDb.data.rxdbVersion,e.rxdbVersion))throw _("DM5",{args:{database:e.name,databaseStateVersion:a.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==a.documentInDb.data.passwordHash)throw _("DB1",{passwordHash:r,existingPasswordHash:a.documentInDb.data.passwordHash});var u=a.documentInDb;return k(u)}throw s}function of(e,t){if(!e||t.includes("beta")&&t!==e)return!1;var r=e.split(".")[0],o=t.split(".")[0];return r===o}function si(e,t){return e+"-"+t.version}function ar(e,t){return t=q(t),t=gs(e,t),typeof e.jsonSchema.primaryKey!="string"&&(t=ds(e.primaryPath,e.jsonSchema,t)),t._meta=Ve(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=Pe()),t}async function su(e,t){t.multiInstance=e.multiInstance;var r=await e.storage.createStorageInstance(t);return r}async function Po(e,t,r,o,n,i,s){var a=await No(t),u=a.filter(h=>h.data.name===n),l=[];u.forEach(h=>{l.push({collectionName:h.data.name,schema:h.data.schema,isCollection:!0}),h.data.connectedStorages.forEach(m=>l.push({collectionName:m.collectionName,isCollection:!1,schema:m.schema}))});var c=new Set;if(l=l.filter(h=>{var m=h.collectionName+"||"+h.schema.version;return c.has(m)?!1:(c.add(m),!0)}),await Promise.all(l.map(async h=>{var m=await e.createStorageInstance({collectionName:h.collectionName,databaseInstanceToken:r,databaseName:o,multiInstance:!1,options:{},schema:h.schema,password:i,devMode:F.isDevMode()});await m.remove(),h.isCollection&&await ze("postRemoveRxCollection",{storage:e,databaseName:o,collectionName:n})})),s){var f=u.map(h=>{var m=sr(h);return m._deleted=!0,m._meta.lwt=re(),m._rev=At(r,h),{previous:h,document:m}});await t.bulkWrite(f,"rx-database-remove-collection-all")}}function de(e){if(e.destroyed)throw _("COL21",{collection:e.name,version:e.schema.version})}var nf=function(){function e(r){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=r,this.subs.push(this.collection.database.eventBulks$.pipe(j(o=>o.collectionName===this.collection.name),j(o=>{var n=o.events[0];return!n.isLocal})).subscribe(o=>{this.tasks.add(()=>this._handleChangeEvents(o.events)),this.tasks.size<=1&&Rt().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){if(this.tasks.size!==0){var o=Array.from(this.tasks);o.forEach(n=>n()),this.tasks.clear()}},t._handleChangeEvents=function(o){var n=this.counter;this.counter=this.counter+o.length,o.length>this.limit?this.buffer=o.slice(o.length*-1):(Ne(this.buffer,o),this.buffer=this.buffer.slice(this.limit*-1));for(var i=n+1,s=this.eventCounterMap,a=0;a<o.length;a++){var u=o[a];s.set(u,i+a)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(o){this.processTasks();var n=this.buffer[0],i=this.eventCounterMap.get(n);if(o<i)return null;var s=o-i;return s},t.getFrom=function(o){this.processTasks();var n=[],i=this.getArrayIndexByPointer(o);if(i===null)return null;for(;;){var s=this.buffer[i];if(i++,s)n.push(s);else return n}},t.runFrom=function(o,n){this.processTasks();var i=this.getFrom(o);if(i===null)throw new Error("out of bounds");i.forEach(s=>n(s))},t.reduceByLastOfDoc=function(o){return this.processTasks(),o.slice(0);var n={};return o.forEach(i=>{n[i.documentId]=i}),Object.values(n)},t.destroy=function(){this.tasks.clear(),this.subs.forEach(o=>o.unsubscribe())},e}();function au(e){return new nf(e)}var sf=new WeakMap;function af(e){var t=e.schema.getDocumentPrototype(),r=uf(e),o=oi,n={};return[t,r,o].forEach(i=>{var s=Object.getOwnPropertyNames(i);s.forEach(a=>{var u=Object.getOwnPropertyDescriptor(i,a),l=!0;(a.startsWith("_")||a.endsWith("_")||a.startsWith("$")||a.endsWith("$"))&&(l=!1),typeof u.value=="function"?Object.defineProperty(n,a,{get(){return u.value.bind(this)},enumerable:l,configurable:!1}):(u.enumerable=l,u.configurable=!1,u.writable&&(u.writable=!1),Object.defineProperty(n,a,u))})}),n}function uu(e){return we(sf,e,()=>tu(af(e)))}function cu(e,t,r){var o=ru(t,e,F.deepFreezeWhenDevMode(r));return e._runHooksSync("post","create",r,o),Q("postCreateRxDocument",o),o}function uf(e){var t={};return Object.entries(e.methods).forEach(([r,o])=>{t[r]=o}),t}var ai=function(e,t){var r=De(e.newDocumentState),o=De(e.realMasterState);return St(r,o)?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})};var fu=["pre","post"],mu=["insert","save","remove","create"],lu=!1,cf=function(){function e(r,o,n,i,s={},a={},u={},l={},c={},f=Jn,h={},m=ai){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=Ha(),this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.onRemove=[],this.database=r,this.name=o,this.schema=n,this.internalStorageInstance=i,this.instanceCreationOptions=s,this.migrationStrategies=a,this.methods=u,this.attachments=l,this.options=c,this.cacheReplacementPolicy=f,this.statics=h,this.conflictHandler=m,lf(this.asRxCollection)}var t=e.prototype;return t.prepare=async function(){this.storageInstance=To(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new eu(this.storageInstance,this.schema.primaryPath,(u,l)=>ni(this,u,l),u=>this._runHooks("post","save",u));var o=this.database.eventBulks$.pipe(j(u=>u.collectionName===this.name));this.$=o.pipe(se(u=>u.events)),this.checkpoint$=o.pipe(J(u=>u.checkpoint)),this._changeEventBuffer=au(this.asRxCollection);var n;this._docCache=new Ya(this.schema.primaryPath,this.database.eventBulks$.pipe(j(u=>u.collectionName===this.name&&!u.events[0].isLocal),J(u=>u.events)),u=>(n||(n=uu(this.asRxCollection)),cu(this.asRxCollection,n,u)));var i=this.database.internalStore.changeStream().pipe(j(u=>{var l=this.name+"-"+this.schema.version,c=u.events.find(f=>f.documentData.context==="collection"&&f.documentData.key===l&&f.operation==="DELETE");return!!c})).subscribe(async()=>{await this.destroy(),await Promise.all(this.onRemove.map(u=>u()))});this._subs.push(i);var s=await this.database.storageToken,a=this.storageInstance.changeStream().subscribe(u=>{for(var l=new Array(u.events.length),c=u.events,f=this.name,h=F.deepFreezeWhenDevMode,m=0;m<c.length;m++){var d=c[m];l[m]={documentId:d.documentId,collectionName:f,isLocal:!1,operation:d.operation,documentData:h(d.documentData),previousDocumentData:h(d.previousDocumentData)}}var y={id:u.id,internal:!1,collectionName:this.name,storageToken:s,events:l,databaseToken:this.database.token,checkpoint:u.checkpoint,context:u.context,endTime:u.endTime,startTime:u.startTime};this.database.$emit(y)});return this._subs.push(a),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe(u=>{this.conflictHandler(u.input,u.context).then(l=>{this.storageInstance.resolveConflictResultionTask({id:u.id,output:l})})})),It},t.cleanup=function(o){throw de(this),D("cleanup")},t.migrationNeeded=function(){throw D("migration-schema")},t.getMigrationState=function(){throw D("migration-schema")},t.startMigration=function(o=10){return de(this),this.getMigrationState().startMigration(o)},t.migratePromise=function(o=10){return this.getMigrationState().migratePromise(o)},t.insert=async function(o){de(this);var n=await this.bulkInsert([o]),i=n.error[0];Bt(this,o[this.schema.primaryPath],o,i);var s=k(n.success[0]);return s},t.bulkInsert=async function(o){if(de(this),o.length===0)return{success:[],error:[]};var n=this.schema.primaryPath,i=new Set,s;if(this.hasHooks("pre","insert"))s=await Promise.all(o.map(b=>{var x=ar(this.schema,b);return this._runHooks("pre","insert",x).then(()=>(i.add(x[n]),{document:x}))}));else{s=new Array(o.length);for(var a=this.schema,u=0;u<o.length;u++){var l=o[u],c=ar(a,l);i.add(c[n]),s[u]={document:c}}}if(i.size!==o.length)throw _("COL22",{collection:this.name,args:{documents:o}});var f=await this.storageInstance.bulkWrite(s,"rx-collection-bulk-insert"),h,m=this,d={get success(){if(!h){var b=xe(m.schema.primaryPath,s,f);h=Co(m._docCache,b)}return h},error:f.error};if(this.hasHooks("post","insert")){var y=new Map;s.forEach(b=>{var x=b.document;y.set(x[n],x)}),await Promise.all(d.success.map(b=>this._runHooks("post","insert",y.get(b.primary),b)))}return d},t.bulkRemove=async function(o){de(this);var n=this.schema.primaryPath;if(o.length===0)return{success:[],error:[]};var i=await this.findByIds(o).exec(),s=[],a=new Map;Array.from(i.values()).forEach(m=>{var d=m.toMutableJSON(!0);s.push(d),a.set(m.primary,d)}),await Promise.all(s.map(m=>{var d=m[this.schema.primaryPath];return this._runHooks("pre","remove",m,i.get(d))}));var u=s.map(m=>{var d=q(m);return d._deleted=!0,{previous:m,document:d}}),l=await this.storageInstance.bulkWrite(u,"rx-collection-bulk-remove"),c=xe(this.schema.primaryPath,u,l),f=c.map(m=>m[n]);await Promise.all(f.map(m=>this._runHooks("post","remove",a.get(m),i.get(m))));var h=f.map(m=>We(i,m));return{success:h,error:l.error}},t.bulkUpsert=async function(o){de(this);var n=[],i=new Map;o.forEach(l=>{var c=ar(this.schema,l),f=c[this.schema.primaryPath];if(!f)throw _("COL3",{primaryPath:this.schema.primaryPath,data:c,schema:this.schema.jsonSchema});i.set(f,c),n.push(c)});var s=await this.bulkInsert(n),a=s.success.slice(0),u=[];return await Promise.all(s.error.map(async l=>{if(l.status!==409)u.push(l);else{var c=l.documentId,f=We(i,c),h=k(l.documentInDb),m=this._docCache.getCachedRxDocuments([h])[0],d=await m.incrementalModify(()=>f);a.push(d)}})),{error:u,success:a}},t.upsert=async function(o){de(this);var n=await this.bulkUpsert([o]);return Bt(this.asRxCollection,o[this.schema.primaryPath],o,n.error[0]),n.success[0]},t.incrementalUpsert=function(o){de(this);var n=ar(this.schema,o),i=n[this.schema.primaryPath];if(!i)throw _("COL4",{data:o});var s=this._incrementalUpsertQueues.get(i);return s||(s=It),s=s.then(()=>mf(this,i,n)).then(a=>a.inserted?a.doc:ff(a.doc,n)),this._incrementalUpsertQueues.set(i,s),s},t.find=function(o){if(de(this),typeof o=="string")throw _("COL5",{queryObj:o});o||(o=ir());var n=Lt("find",o,this);return n},t.findOne=function(o){if(de(this),typeof o=="number"||Array.isArray(o))throw pr("COL6",{queryObj:o});var n;if(typeof o=="string")n=Lt("findOne",{selector:{[this.schema.primaryPath]:o},limit:1},this);else{if(o||(o=ir()),o.limit)throw _("QU6");o=q(o),o.limit=1,n=Lt("findOne",o,this)}return n},t.count=function(o){de(this),o||(o=ir());var n=Lt("count",o,this);return n},t.findByIds=function(o){de(this);var n={selector:{[this.schema.primaryPath]:{$in:o.slice(0)}}},i=Lt("findByIds",n,this);return i},t.exportJSON=function(){throw D("json-dump")},t.importJSON=function(o){throw D("json-dump")},t.insertCRDT=function(o){throw D("crdt")},t.addPipeline=function(o){throw D("pipeline")},t.addHook=function(o,n,i,s=!1){if(typeof i!="function")throw pr("COL7",{key:n,when:o});if(!fu.includes(o))throw pr("COL8",{key:n,when:o});if(!mu.includes(n))throw _("COL9",{key:n});if(o==="post"&&n==="create"&&s===!0)throw _("COL10",{when:o,key:n,parallel:s});var a=i.bind(this),u=s?"parallel":"series";this.hooks[n]=this.hooks[n]||{},this.hooks[n][o]=this.hooks[n][o]||{series:[],parallel:[]},this.hooks[n][o][u].push(a)},t.getHooks=function(o,n){return!this.hooks[n]||!this.hooks[n][o]?{series:[],parallel:[]}:this.hooks[n][o]},t.hasHooks=function(o,n){if(!this.hooks[n]||!this.hooks[n][o])return!1;var i=this.getHooks(o,n);return i?i.series.length>0||i.parallel.length>0:!1},t._runHooks=function(o,n,i,s){var a=this.getHooks(o,n);if(!a)return It;var u=a.series.map(l=>()=>l(i,s));return ps(u).then(()=>Promise.all(a.parallel.map(l=>l(i,s))))},t._runHooksSync=function(o,n,i,s){if(this.hasHooks(o,n)){var a=this.getHooks(o,n);a&&a.series.forEach(u=>u(i,s))}},t.promiseWait=function(o){var n=new Promise(i=>{var s=setTimeout(()=>{this.timeouts.delete(s),i()},o);this.timeouts.add(s)});return n},t.destroy=async function(){return this.destroyed?Ie:(await Promise.all(this.onDestroy.map(o=>o())),this.destroyed=!0,Array.from(this.timeouts).forEach(o=>clearTimeout(o)),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(o=>o.unsubscribe()),delete this.database.collections[this.name],ze("postDestroyRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.destroy(),await Promise.all(this.onRemove.map(o=>o())),await Po(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.password,this.database.hashFunction)},ee(e,[{key:"insert$",get:function(){return this.$.pipe(j(r=>r.operation==="INSERT"))}},{key:"update$",get:function(){return this.$.pipe(j(r=>r.operation==="UPDATE"))}},{key:"remove$",get:function(){return this.$.pipe(j(r=>r.operation==="DELETE"))}},{key:"asRxCollection",get:function(){return this}}])}();function lf(e){if(!lu){lu=!0;var t=Object.getPrototypeOf(e);mu.forEach(r=>{fu.map(o=>{var n=o+zr(r);t[n]=function(i,s){return this.addHook(o,r,i,s)}})})}}function ff(e,t){return e.incrementalModify(r=>t)}function mf(e,t,r){var o=e._docCache.getLatestDocumentDataIfExists(t);return o?Promise.resolve({doc:e._docCache.getCachedRxDocuments([o])[0],inserted:!1}):e.findOne(t).exec().then(n=>n?{doc:n,inserted:!1}:e.insert(r).then(i=>({doc:i,inserted:!0})))}function pu({database:e,name:t,schema:r,instanceCreationOptions:o={},migrationStrategies:n={},autoMigrate:i=!0,statics:s={},methods:a={},attachments:u={},options:l={},localDocuments:c=!1,cacheReplacementPolicy:f=Jn,conflictHandler:h=ai}){var m={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:o,multiInstance:e.multiInstance,password:e.password,devMode:F.isDevMode()};return Q("preCreateRxStorageInstance",m),su(e,m).then(d=>{var y=new cf(e,t,r,d,o,n,a,u,l,f,s,h);return y.prepare().then(()=>{Object.entries(s).forEach(([x,w])=>{Object.defineProperty(y,x,{get:()=>w.bind(y)})});var b=It;return i&&y.schema.version!==0&&(b=y.migratePromise()),b}).then(()=>(Q("createRxCollection",{collection:y,creator:{name:t,schema:r,storageInstance:d,instanceCreationOptions:o,migrationStrategies:n,methods:a,attachments:u,options:l,cacheReplacementPolicy:f,localDocuments:c,statics:s}}),y)).catch(b=>d.close().then(()=>Promise.reject(b)))})}var li=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this._parallels=t||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};li.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,ci(this)},wrapCall:function(t){var r=this;this.lock();var o;try{o=t()}catch(n){throw this.unlock(),n}return!o.then||typeof o.then!="function"?(this.unlock(),o):o.then(function(n){return r.unlock(),n}).catch(function(n){throw r.unlock(),n})},requestIdlePromise:function(t){var r=this;t=t||{};var o,n=new Promise(function(a){return o=a}),i=function(){ui(r,n),o()};if(n._manRes=i,t.timeout){var s=setTimeout(function(){n._manRes()},t.timeout);n._timeoutObj=s}return this._iC.add(n),ci(this),n},cancelIdlePromise:function(t){ui(this,t)},requestIdleCallback:function(t,r){var o=this._lHN++,n=this.requestIdlePromise(r);return this._hPM.set(o,n),this._pHM.set(n,o),n.then(function(){return t()}),o},cancelIdleCallback:function(t){var r=this._hPM.get(t);this.cancelIdlePromise(r)},clear:function(){var t=this;this._iC.forEach(function(r){return ui(t,r)}),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}};function pf(e){if(e._iC.size!==0){var t=e._iC.values(),r=t.next().value;r._manRes(),setTimeout(function(){return ci(e)},0)}}function ui(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var r=e._pHM.get(t);e._hPM.delete(r),e._pHM.delete(t)}e._iC.delete(t)}}function ci(e){e._tryIR||e._iC.size===0||(e._tryIR=!0,setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}setTimeout(function(){if(!e.isIdle()){e._tryIR=!1;return}pf(e),e._tryIR=!1},0)},0))}var ko=class{ttl;map=new Map;_to=!1;constructor(t){this.ttl=t}has(t){return this.map.has(t)}add(t){this.map.set(t,hu()),this._to||(this._to=!0,setTimeout(()=>{this._to=!1,hf(this)},0))}clear(){this.map.clear()}};function hf(e){let t=hu()-e.ttl,r=e.map[Symbol.iterator]();for(;;){let o=r.next().value;if(!o)return;let n=o[0];if(o[1]<t)e.map.delete(n);else return}}function hu(){return Date.now()}var Fo=new Set,du=0,df=function(){function e(r,o,n,i,s,a,u=!1,l={},c,f,h,m,d){this.idleQueue=new li,this.rxdbVersion=dn,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.states={},this.eventBulks$=new Ae,this.observable$=this.eventBulks$.pipe(se(y=>y.events)),this.storageToken=Ie,this.storageTokenDocument=Ie,this.emittedEventBulkIds=new ko(60*1e3),this.name=r,this.token=o,this.storage=n,this.instanceCreationOptions=i,this.password=s,this.multiInstance=a,this.eventReduce=u,this.options=l,this.internalStore=c,this.hashFunction=f,this.cleanupPolicy=h,this.allowSlowCount=m,this.reactivity=d,du++,this.name!=="pseudoInstance"&&(this.internalStore=To(this.asRxDatabase,c,Do),this.storageTokenDocument=iu(this.asRxDatabase).catch(y=>this.startupErrors.push(y)),this.storageToken=this.storageTokenDocument.then(y=>y.data.token).catch(y=>this.startupErrors.push(y)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw _("DB14",{database:this.name});return this.reactivity},t.$emit=function(o){this.emittedEventBulkIds.has(o.id)||(this.emittedEventBulkIds.add(o.id),this.eventBulks$.next(o))},t.removeCollectionDoc=async function(o,n){var i=await ti(this.internalStore,Mo(si(o,n),Ut));if(!i)throw _("SNH",{name:o,schema:n});var s=sr(i);s._deleted=!0,await this.internalStore.bulkWrite([{document:s,previous:i}],"rx-database-remove-collection")},t.addCollections=async function(o){var n={},i={},s=[],a={};await Promise.all(Object.entries(o).map(async([c,f])=>{var h=c,m=f.schema;n[h]=m;var d=vs(m,this.hashFunction);if(i[h]=d,this.collections[c])throw _("DB3",{name:c});var y=si(c,m),b={id:Mo(y,Ut),key:y,context:Ut,data:{name:h,schemaHash:await d.hash,schema:d.jsonSchema,version:d.version,connectedStorages:[]},_deleted:!1,_meta:Ve(),_rev:Pe(),_attachments:{}};s.push({document:b});var x=Object.assign({},f,{name:h,schema:d,database:this}),w=q(f);w.database=this,w.name=c,Q("preCreateRxCollection",w),x.conflictHandler=w.conflictHandler,a[h]=x}));var u=await this.internalStore.bulkWrite(s,"rx-database-add-collection");await vf(this),await Promise.all(u.error.map(async c=>{if(c.status!==409)throw _("DB12",{database:this.name,writeError:c});var f=k(c.documentInDb),h=f.data.name,m=i[h];if(f.data.schemaHash!==await m.hash)throw _("DB6",{database:this.name,collection:h,previousSchemaHash:f.data.schemaHash,schemaHash:await m.hash,previousSchema:f.data.schema,schema:k(n[h])})}));var l={};return await Promise.all(Object.keys(o).map(async c=>{var f=a[c],h=await pu(f);l[c]=h,this.collections[c]=h,this[c]||Object.defineProperty(this,c,{get:()=>this.collections[c]})})),l},t.lockedRun=function(o){return this.idleQueue.wrapCall(o)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(o){throw D("json-dump")},t.addState=function(o){throw D("state")},t.importJSON=function(o){throw D("json-dump")},t.backup=function(o){throw D("backup")},t.leaderElector=function(){throw D("leader-election")},t.isLeader=function(){throw D("leader-election")},t.waitForLeadership=function(){throw D("leader-election")},t.migrationStates=function(){throw D("migration-schema")},t.destroy=async function(){return this.destroyed?Ie:(this.destroyed=!0,await ze("preDestroyRxDatabase",this),this.eventBulks$.complete(),du--,this._subs.map(o=>o.unsubscribe()),this.name==="pseudoInstance"?Ie:this.requestIdlePromise().then(()=>Promise.all(this.onDestroy.map(o=>o()))).then(()=>Promise.all(Object.keys(this.collections).map(o=>this.collections[o]).map(o=>o.destroy()))).then(()=>this.internalStore.close()).then(()=>Fo.delete(this.storage.name+"|"+this.name)).then(()=>!0))},t.remove=function(){return this.destroy().then(()=>gf(this.name,this.storage,this.password))},ee(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();function yf(e,t){var r=t.name+"|"+e;if(Fo.has(r))throw _("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}async function yu(e,t,r,o,n,i){var s=await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:Xa,schema:Do,options:o,multiInstance:n,password:i,devMode:F.isDevMode()});return s}function J2({storage:e,instanceCreationOptions:t,name:r,password:o,multiInstance:n=!0,eventReduce:i=!0,ignoreDuplicate:s=!1,options:a={},cleanupPolicy:u,allowSlowCount:l=!1,localDocuments:c=!1,hashFunction:f=os,reactivity:h}){Q("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:o,multiInstance:n,eventReduce:i,ignoreDuplicate:s,options:a,localDocuments:c}),s||yf(r,e),Fo.add(e.name+"|"+r);var m=st(10);return yu(m,e,r,t,n,o).catch(d=>{throw Fo.delete(e.name+"|"+r),d}).then(d=>{var y=new df(r,m,e,t,o,n,i,a,d,f,u,l,h);return ze("createRxDatabase",{database:y,creator:{storage:e,instanceCreationOptions:t,name:r,password:o,multiInstance:n,eventReduce:i,ignoreDuplicate:s,options:a,localDocuments:c}}).then(()=>y)})}async function gf(e,t,r){var o=st(10),n=await yu(o,t,e,{},!1,r),i=await No(n),s=new Set;i.forEach(u=>s.add(u.data.name));var a=Array.from(s);return await Promise.all(a.map(u=>Po(t,n,o,e,u,r))),await ze("postRemoveRxDatabase",{databaseName:e,storage:t}),await n.remove(),a}async function vf(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}export{K as a,Du as b,R as c,tn as d,rn as e,Ae as f,Wt as g,zt as h,rc as i,oc as j,rt as k,ye as l,Zo as m,nc as n,ic as o,ot as p,J as q,Yu as r,se as s,nt as t,wt as u,sc as v,ac as w,uc as x,cc as y,j as z,Gi as A,fc as B,Qt as C,un as D,tt as E,pc as F,hc as G,dc as H,cn as I,yc as J,gc as K,vc as L,xt as M,Yt as N,ji as O,Xu as P,xc as Q,bc as R,Zi as S,Ot as T,Ne as U,wx as V,Ou as W,Eu as X,q as Y,os as Z,at as _,Tx as $,St as aa,$t as ba,Nx as ca,we as da,re as ea,k as fa,dn as ga,Fx as ha,Lx as ia,F as ja,_ as ka,pr as la,xn as ma,Q as na,ct as oa,ds as pa,qe as qa,Bc as ra,ib as sa,Jt as ta,Xt as ua,Wa as va,Ro as wa,zl as xa,Zn as ya,RF as za,sr as Aa,CF as Ba,oi as Ca,tu as Da,cf as Ea,ko as Fa,df as Ga,J2 as Ha};
